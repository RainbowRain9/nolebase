# Epic 7: 资料库（语义检索与版本）

权威来源：../../prd.md#L1048


**Epic 目标：** 对话检索/对比/引用与版本建议；方案/零件/PLC 资料库；智能检索与上传版本管理。

**Epic 描述（现状与增强）：**
- 现有：缺少资料结构化与版本能力，检索以关键字为主。
- 增强：语义+关键词混排检索，版本管理与 diff，引用卡片插入对话/文档。

**Stories（概览）：**
- 见下方 Story 7.1–7.3 的详细验收要点。

**兼容性要求：**
- 文件存储与外链权限与现有规范一致；
- 版本兼容与迁移工具。

**风险与回滚：**
- 风险：召回/相关性不稳定；外链权限误配。
- 缓解：可调参数与评估面板；外链有效期与权限模板。
- 回滚：保留普通上传+关键字检索兜底。

**完成定义（DoD）：**
- Story 7.1–7.3 验收通过；
- 引用卡片可用于对话/文档；
- 版本管理与 diff 可用；
- 检索效果有评估指标。

**验证清单（自检）：**
- 范围：检索/引用/版本；
- 风险：权限/召回控制机制有效；
- 完整：评估报告与退化路径存在。

#### Story 7.1: 对话（资料）与引用卡片
验收要点：
1. 语义检索 + 关键词混排；结果卡片可引用/对比。
2. 生成引用卡片并插入到对话或文档。
3. 跨公司检索受限与审计。

验收标准（Given-When-Then）：
- Given 用户进行资料语义检索
  When 选择两条结果进行对比
  Then 生成对比卡片并可插入到对话或文档
- Given 当前公司无权访问目标资料
  When 发起跨公司检索
  Then 返回受限提示并记录审计

#### Story 7.2: 资料库结构与版本
验收要点：
1. 方案/零件/PLC 分类与元数据；版本管理。
2. 上传抽取摘要/标签；版本 diff。
3. 外链分享（时效/权限）。

验收标准（Given-When-Then）：
- Given 上传新版本资料
  When 完成解析
  Then 自动生成摘要/标签并可与上版进行 diff
- Given 生成外链分享
  When 设置有效期与权限
  Then 链接在有效期内可访问并受权限控制

#### Story 7.3: 智能检索与推荐
验收要点：
1. 近义/相似推荐与去重；高召回与可解释。
2. 支持过滤/排序与收藏。
3. 检索效果可评估与反馈闭环。

验收标准（Given-When-Then）：
- Given 用户进行检索
  When 选择“相似推荐”并去重
  Then 返回去重后的相似结果并提供可解释信息
- Given 用户反馈“不相关”
  When 累积到阈值
  Then 推荐模型调整并在评估面板反映改进

