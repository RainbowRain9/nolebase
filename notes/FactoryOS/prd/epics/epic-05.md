# Epic 5: 审批管理（对话与流程配置）

权威来源：../../prd.md#L902


**Epic 目标：** 对话发起/催办/回撤/解释规则；常用申请模板；待办/历史；流程可视化配置与规则说明。

**Epic 描述（现状与增强）：**
- 现有：缺乏对话驱动的审批体验与规则可解释；流程配置未版本化。
- 增强：对话生成带表单片段的操作卡片；流程/规则可视化配置与解释；全链路审计。

**Stories（概览）：**
- 见下方 Story 5.1–5.3 的详细验收要点。

**兼容性要求：**
- 沿用现有 UI/权限规范；与工作台待办聚合无缝联动；
- 流程配置变更版本化与灰度。

**风险与回滚：**
- 风险：复杂流程导致性能与易用性下降；规则误配风险。
- 缓解：模板化常用流程、变更前模拟校验、二次确认。
- 回滚：保留旧流程引擎与静态表单路径。

**完成定义（DoD）：**
- Story 5.1–5.3 验收通过；
- 对话-表单片段-流程三者互通；
- 审计与导出可用；
- E2E 场景覆盖“发起-审批-撤回/催办-历史”。

**验证清单（自检）：**
- 范围：常用申请/待办/历史/流程配置与规则解释；
- 风险：模板化与模拟校验覆盖关键路径；
- 完整：与命令面板与工作台联动验证通过。

#### Story 5.1: 对话（审批）与常用申请
验收要点：
1. 对话生成带表单片段的操作卡片（请假/出差/报销/用章）。
2. 草稿/附件/抄送与通知；权限校验。
3. 支持撤回/催办并记录审计。

验收标准（Given-When-Then）：
- Given 用户在对话输入“发起请假3天”
  When 表单片段要求补充日期与原因
  Then 填写并提交后生成申请单，通知相关人员并记录审计
- Given 申请处于处理中
  When 用户执行“撤回”
  Then 流程撤回成功并生成撤回审计记录

#### Story 5.2: 待办/我发起/历史
验收要点：
1. 统一视图、筛选与批量；命令面板可操作。
2. 历史可按单据/人/规则检索与导出。
3. 与工作台待办联动。

验收标准（Given-When-Then）：
- Given 待办列表存在多条任务
  When 选择多条并执行“批量通过/拒绝”
  Then 批量处理成功并可在历史中按条件检索、导出
- Given 工作台与待办视图
  When 在工作台处理待办
  Then 待办视图实时同步状态

#### Story 5.3: 流程配置与规则解释
验收要点：
1. 可视化流程/条件/节点权限配置。
2. 对话解释当前单据命中规则与原因。
3. 版本化规则与回滚；变更留痕。

验收标准（Given-When-Then）：
- Given 流程新增条件节点配置
  When 发布新版本
  Then 新版本生效且可一键回滚到旧版本，变更有留痕
- Given 用户在对话询问“为什么进入二级审批”
  When 系统分析当前单据与规则
  Then 返回命中规则与原因说明

