# FactoryOS 项目开发计划与进度报告

## 项目概述 (Project Overview)
- **目标**：为微柏与鲤东集团打造一体化的企业级 AI 协作平台，让项目管理、财务报表、审批与人事流程实现智能协同与实时透明化。
- [ ] 总体进度：13%

## 开发里程碑 (Development Milestones)

### M1: 基础内核与多租户安全 (预计完成时间: 2025-11-21)
- [ ] 完成度：13%

### M2: 项目与审批核心闭环 (预计完成时间: 2025-12-19)
- [ ] 完成度：13%

### M3: 财务智能报表与人事效率 (预计完成时间: 2026-01-30)
- [ ] 完成度：13%

---

## 详细功能与任务分解 (Features & Tasks Breakdown)

### M1: 基础内核与多租户安全

#### ✨ 功能 1.1: 多租户账号体系与安全认证
- [ ] **业务价值**：确保三家公司用户在同一平台安全登录，数据严格隔离，满足企业级安全要求。
- [x] **状态**: 阶段一/二完成 - 前端功能原型已可演示 (基于模拟数据)
<details>
<summary>点击展开企业级交付全景任务</summary>

**1. 需求与设计阶段 (Design & Specification)**
- [x] **业务分析**: 深入分析 PRD，将登录/注册、权限分配、租户隔离等需求转化为功能规格。
- [x] **架构设计**: 根据 `architecture.md` 评估多租户认证、权限体系对现有架构的影响并完成设计评审。
- [x] **API 规约**: 在 `api-spec.md` 中定义 `/api/v1/auth/*`、`/api/v1/auth/codes` 等真实接口并通过评审。
- [x] **数据库设计**: 在 `database-schema.md` 中确认 `users`、`user_roles`、`refresh_tokens` 等表结构与审计字段。
- [x] **UX/UI 设计**: 输出登录、注册、权限提示及租户切换的高保真界面与交互原型。

**2. 前端开发阶段 (Frontend Development - Mock First)**
- [x] **组件化开发**: 按照设计稿完成登录表单、租户下拉、权限提示等 Vue 组件的开发与封装。
- [x] **页面构建**: 构建认证入口、注册引导、权限受限提醒等页面，并接入路由守卫。
- [x] **状态管理**: 设计 Pinia Store 管理 Token、用户上下文、权限码与租户信息。
- [x] **Mock 数据对接**: 完成与 Mock `/api/auth/*`、`/api/auth/codes` 的数据交互，验证登录/登出、权限展示全流程 `(已完成)`.
- [ ] **单元测试 (FE)**: 为认证组件、权限守卫等关键逻辑编写单元测试。

**3. 后端开发阶段 (Backend Development - Real Implementation)**
- [ ] **数据库迁移**: 编写并执行多租户用户、角色、刷新令牌等表的迁移脚本。
- [ ] **真实接口实现**: 实现生产级 `/api/v1/auth/login|refresh|logout|me|codes`，支持密码学加密、刷新令牌、租户上下文。
- [ ] **安全与权限**: 集成 RBAC/ABAC 校验，确保跨租户访问被拒绝并记录审计日志。
- [ ] **业务校验**: 实现注册校验、账号锁定、密码策略、租户有效期等业务规则。
- [ ] **单元/集成测试 (BE)**: 编写认证、刷新、权限、租户校验相关的单元与集成测试。

**4. 集成与质量保障阶段 (Integration & QA)**
- [ ] **前后端联调**: 将前端从 Mock 切换到真实认证服务，验证多租户上下文与权限差异。
- [ ] **端到端 (E2E) 测试**: 编写登录、登出、权限受限页面的 E2E 自动化脚本。
- [ ] **性能测试**: 对登录、刷新等高频接口执行压力测试，确保满足吞吐量与响应时间指标。
- [ ] **安全渗透测试**: 针对登录模块开展渗透测试，防御暴力破解、Token 劫持等风险。
- [ ] **回归测试**: 确认认证改动不会破坏其他业务模块的访问控制。

**5. 部署与验收阶段 (Deployment & UAT)**
- [ ] **文档完善**: 更新用户操作手册、访问控制指引及开发文档。
- [ ] **部署至测试环境 (Staging)**: 将认证服务部署到准生产环境，开启灰度验证。
- [ ] **用户验收测试 (UAT)**: 邀请甲方关键用户验证多租户登录与权限配置流程。
- [ ] **生产环境部署 (Production)**: 验收通过后上线生产环境，并安排上线后监控与支持。
</details>

**审计备注与进展说明 (2025-10-29):**
* **当前进展**：我们已完成本功能的设计规约与前端原型开发，登录、登出、权限展示等交互全部可在 Mock 数据下演示，支持董事会成员亲自体验。
* **工作量解读**：该阶段覆盖了业务需求拆解、架构对齐、API 与数据库设计，以及前端组件化构建与状态管理，确保后续真实后端开发可以在稳固基线上推进。
* **下一步计划**：后端团队将进入真实实现阶段，完成多租户认证、权限校验、审计日志等工作；随后我们将执行联调、性能与安全测试，直至通过验收上线。

#### ✨ 功能 1.2: 命令面板与对话入口统一基座
- [ ] **业务价值**：为甲方员工提供统一的 AI 对话与快捷命令入口，提升工作效率与操作一致性。
- [ ] **状态**: 未开始
<details>
<summary>点击查看技术实现任务</summary>

- [ ] **后端**: 建立 `ai_conversations`、`ai_conversation_messages` 的 CRUD API，支持上下文保存与权限校验。
- [ ] **前端**: 实现命令面板 UI（参考 PRD Epic 1），支持快捷搜索、历史记录与权限过滤。
- [ ] **前端**: 对话页面改造为公用组件，支持多 Agent 切换与流程卡片回填。
- [ ] **数据**: 初始化模板数据与 AI Agent 配置，为审批/项目/财务对话提供示范上下文。
- [ ] **测试**: 针对对话保存、命令触发的端到端测试。
</details>

#### ✨ 功能 1.3: 审计日志与权限网关
- [ ] **业务价值**：满足甲方合规要求，确保敏感操作有迹可循，避免越权访问。
- [ ] **状态**: 未开始
<details>
<summary>点击查看技术实现任务</summary>

- [ ] **后端**: 开发统一权限网关，基于 `roles`、`permissions`、`user_roles`、`role_permissions` 验证实体/字段级权限。
- [ ] **后端**: 实现 `approval_audit_logs` 写入服务及 `GET /api/v1/audit/logs` 查询接口（内部使用）。
- [ ] **数据库**: 配置审计表索引、归档策略与触发器。
- [ ] **前端**: 在操作按钮级别接入权限码，动态隐藏无权限功能。
- [ ] **测试**: 安全与权限测试，包括权限绕过场景。
</details>

---

### M2: 项目与审批核心闭环

#### ✨ 功能 2.1: 对话驱动的项目创建与模板套用
- [ ] **业务价值**：项目经理可通过对话快速创建项目、任务和里程碑，缩短立项时间。
- [ ] **状态**: 未开始
<details>
<summary>点击查看技术实现任务</summary>

- [ ] **后端**: 实现 `POST /api/v1/projects`、`POST /api/v1/projects/{id}/tasks`、`POST /api/v1/projects/{id}/weekly-deliveries`，支持模板导入与幂等。
- [ ] **后端**: 构建项目模板管理 API（`project_templates`），支撑参数化生成。
- [ ] **前端**: 开发“项目概览”“任务/甘特”“模板中心”页面，支持对话回填。
- [ ] **前端**: 集成 AI 对话输出，与项目 API 对接并提供操作确认。
- [ ] **测试**: 项目创建、模板套用、甘特图交互的自动化测试。
</details>

#### ✨ 功能 2.2: 审批待办与历史的统一工作台（请假流程）
- [ ] **业务价值**：审批人可以在一个界面处理所有待办/历史，支持批量操作与流程解释。
- [x] **状态**: 阶段一/二完成 - 前端功能原型已可演示 (基于模拟数据)
<details>
<summary>点击展开企业级交付全景任务</summary>

**1. 需求与设计阶段 (Design & Specification)**
- [x] **业务分析**: 将 PRD 中的请假申请、审批节点、SLA 与催办规则拆解为详细流程说明。
- [x] **架构设计**: 在 `architecture.md` 中评估审批引擎、流程编排、审计日志对系统的影响并确认解决方案。
- [x] **API 规约**: 在 `api-spec.md` 定义 `POST /api/v1/approval-requests`、`GET /api/v1/approvals/inbox|history`、`POST /api/v1/approvals/{step_id}/actions` 等接口。
- [x] **数据库设计**: 完成 `approval_requests`、`approval_request_steps`、`approval_audit_logs` 等数据模型设计与实体关系验证。
- [x] **UX/UI 设计**: 输出待办工作台、审批历史、请假申请表单、流程解释弹窗等高保真原型。

**2. 前端开发阶段 (Frontend Development - Mock First)**
- [x] **组件化开发**: 开发审批列表、步骤时间线、催办对话框等可复用组件。
- [x] **页面构建**: 完成“待我处理 / 我发起 / 历史记录 / 发起请假”页面与路由结构。
- [x] **状态管理**: 通过 Pinia Store 管理审批队列、筛选条件、SLA 指标与用户操作状态。
- [x] **Mock 数据对接**: 接入 Mock `/approvals/*`、`/requests` 接口，完整演示请假发起、审批、驳回、催办流程 `(已完成)`.
- [ ] **单元测试 (FE)**: 补充审批动作、筛选逻辑、流程解释组件的前端单元测试。

**3. 后端开发阶段 (Backend Development - Real Implementation)**
- [ ] **数据库迁移**: 编写审批请求、审批步骤、动作历史、SLA 指标等表的迁移脚本。
- [ ] **真实接口实现**: 实现审批请求创建、待办列表、历史查询、节点动作等生产级接口及流程编排。
- [ ] **安全与权限**: 集成租户隔离、审批角色校验、数据脱敏与审计日志。
- [ ] **业务校验**: 实现请假余额校验、流程版本选择、SLA 计时、催办频率限制等规则。
- [ ] **单元/集成测试 (BE)**: 为审批引擎、活动节点、状态流转编写单元与集成测试。

**4. 集成与质量保障阶段 (Integration & QA)**
- [ ] **前后端联调**: 将前端切换至真实审批服务，处理数据结构与状态差异。
- [ ] **端到端 (E2E) 测试**: 编写从请假发起到审批完成的自动化测试脚本。
- [ ] **性能测试**: 对审批待办、批量操作、催办接口执行压力与并发测试。
- [ ] **安全渗透测试**: 检测流程伪造、越权审批、数据泄露等风险。
- [ ] **回归测试**: 验证审批模块集成后不会影响其他业务域。

**5. 部署与验收阶段 (Deployment & UAT)**
- [ ] **文档完善**: 更新审批流程操作手册、流程配置指南与异常处理文档。
- [ ] **部署至测试环境 (Staging)**: 上线准生产环境，准备真实审批规则与测试数据。
- [ ] **用户验收测试 (UAT)**: 组织审批人、流程管理员参与验收，验证业务场景。
- [ ] **生产环境部署 (Production)**: 验收通过后上线生产，并安排上线后支持与监控。
</details>

**审计备注与进展说明 (2025-10-29):**
* **当前进展**：请假流程的设计规约及前端原型已完成，审批人可以在 Mock 环境下完整体验待办处理、驳回、催办等场景。
* **工作量解读**：该阶段覆盖流程建模、数据结构设计、前端工作台搭建与交互验证，确保企业级审批场景的复杂性已被充分消化。
* **下一步计划**：后端将实现真实审批引擎与 SLA 机制，之后我们将推进联调、自动化测试与性能/安全验证，直至通过甲方验收。

#### ✨ 功能 2.3: 项目周交付与风险预警
- [ ] **业务价值**：让甲方高层及时掌握项目进展、风险和成本偏差，实现精细化运营。
- [ ] **状态**: 未开始
<details>
<summary>点击查看技术实现任务</summary>

- [ ] **后端**: 按 `api-spec.md` 实现周交付、风险预警相关 API，并与 `project_cost_records`、`financial_alert_events` 打通。
- [ ] **数据**: 构建定时计算服务，同步成本偏差与风险阈值触发逻辑。
- [ ] **前端**: 开发项目周报查看页，支持 AI 生成摘要与导出。
- [ ] **前端**: 在看板/Gantt 中高亮风险任务与 SLA 状态。
- [ ] **测试**: 验证成本偏差计算、风险通知与前端渲染。
</details>

---

### M3: 财务智能报表与人事效率

#### ✨ 功能 3.1: 多库财务数据汇聚与智能报表
- [ ] **业务价值**：实时整合三种财务数据库，自动生成财务报表和预警，支持管理层快速决策。
- [ ] **状态**: 未开始
<details>
<summary>点击查看技术实现任务</summary>

- [ ] **后端**: 实现 `POST /api/v1/finance/records`, `GET /api/v1/finance/records`, `POST /api/v1/finance/report-runs`, `GET /api/v1/finance/alert-events`，并构建数据源连接器。
- [ ] **后端**: 构建报表调度与缓存层，支持模板版本、订阅推送。
- [ ] **数据**: 设计同步作业（`financial_sync_jobs`）与运行日志。
- [ ] **前端**: 开发财务仪表盘、报表列表与预警中心页面，支持钻取到凭证。
- [ ] **测试**: 财务数据同步、报表生成与预警触发的端到端测试。
</details>

#### ✨ 功能 3.2: 人事档案、打卡出勤与效率评分
- [ ] **业务价值**：帮助 HR 与管理层掌握员工状态、出勤效率与人才结构，支撑精细化的人力决策。
- [x] **状态**: 阶段一/二完成 - 前端功能原型已可演示 (基于模拟数据)
<details>
<summary>点击展开企业级交付全景任务</summary>

**1. 需求与设计阶段 (Design & Specification)**
- [x] **业务分析**: 解析 PRD 中的人事档案、打卡出勤、效率评分、报告生成等场景并形成规格说明。
- [x] **架构设计**: 在 `architecture.md` 中确认员工档案、出勤数据、效率评分服务的系统边界与依赖。
- [x] **API 规约**: 在 `api-spec.md` 定义 `GET/PUT /api/v1/hr/employees`、`GET /api/v1/hr/org-tree`、`GET /api/v1/hr/attendance`、`POST /api/v1/hr/efficiency-reports` 等接口。
- [x] **数据库设计**: 设计/确认 `employee_records`、`employee_attendance_records`、`employee_efficiency_scores` 等表结构与审计字段。
- [x] **UX/UI 设计**: 输出员工档案、组织树、打卡报表、效率仪表盘及报告生成流程的高保真原型。

**2. 前端开发阶段 (Frontend Development - Mock First)**
- [x] **组件化开发**: 开发员工资料卡、组织树导航、出勤图表、效率指标卡等组件。
- [x] **页面构建**: 搭建员工档案、组织结构、效率分析、报告生成等页面与路由。
- [x] **状态管理**: 通过 Pinia Store 管理员工数据、筛选条件、出勤/效率 KPI 与报告草稿状态。
- [x] **Mock 数据对接**: 与 Mock `/hr/employees`、`/hr/org-tree`、`/attendance`、`/efficiency` 接口联调，演示查询、筛选、报告生成流程 `(已完成)`.
- [ ] **单元测试 (FE)**: 为档案列表、考勤图表、效率模块编写前端单元测试。

**3. 后端开发阶段 (Backend Development - Real Implementation)**
- [ ] **数据库迁移**: 编写员工档案、出勤记录、效率评分、报告历史等数据表的迁移脚本。
- [ ] **真实接口实现**: 实现 `GET/PUT /api/v1/hr/employees`、`GET /api/v1/hr/attendance`、`POST /api/v1/hr/efficiency-reports` 等生产接口。
- [ ] **安全与权限**: 落地字段级权限控制、数据脱敏、审批挂载及审计日志。
- [ ] **业务校验**: 实现出勤异常规则、效率评分算法、报告提交流程与审批联动。
- [ ] **单元/集成测试 (BE)**: 针对员工档案更新、打卡同步、效率计算编写测试。

**4. 集成与质量保障阶段 (Integration & QA)**
- [ ] **前后端联调**: 将前端切换至真实 HR/出勤/效率接口，校正数据结构与权限差异。
- [ ] **端到端 (E2E) 测试**: 编写员工档案维护、出勤分析、效率报告生成的 E2E 测试。
- [ ] **性能测试**: 对出勤统计、效率计算、报告生成等高负载接口执行性能测试。
- [ ] **安全渗透测试**: 检查人事数据访问、权限绕过、敏感字段泄露等风险。
- [ ] **回归测试**: 确保 HR 模块上线不会影响项目、审批等其他业务。

**5. 部署与验收阶段 (Deployment & UAT)**
- [ ] **文档完善**: 更新 HR 运营手册、出勤管理指南、效率报表操作说明。
- [ ] **部署至测试环境 (Staging)**: 将 HR 服务部署到准生产环境，准备同步任务与集成配置。
- [ ] **用户验收测试 (UAT)**: 邀请 HRBP、部门经理进行功能验收与反馈。
- [ ] **生产环境部署 (Production)**: 验收通过后部署到生产环境并进行上线检查。
</details>

**审计备注与进展说明 (2025-10-29):**
* **当前进展**：人事档案、组织树、出勤与效率视图的前端原型已就绪，模拟数据可覆盖查询、筛选与报告生成体验。
* **工作量解读**：我们完成了需求拆解、数据建模、组件化开发等复杂工作，确保 HR 域后续与真实数据打通时能快速集成。
* **下一步计划**：后端将实现真实的人事与打卡数据服务，并联通审批流程；接下来我们会进入联调、自动化测试、性能/安全验证和验收阶段。

#### ✨ 功能 3.3: 资料库语义检索与安全分享
- [ ] **业务价值**：让销售、工程、法务等角色快速找到最新资料，支持安全分享与审计。
- [ ] **状态**: 未开始
<details>
<summary>点击查看技术实现任务</summary>

- [ ] **后端**: 实现 `POST /api/v1/knowledge/assets`, `GET /api/v1/knowledge/assets`, `POST /api/v1/knowledge/search`，含标签、分享链接与向量检索。
- [ ] **后端**: 集成向量数据库/Elasticsearch，支持权限过滤与命中高亮。
- [ ] **前端**: 开发资料库管理界面、上传流程和搜索体验，接入预览与分享。
- [ ] **数据**: 建立索引刷新任务与分享链接有效期监控。
- [ ] **测试**: 资料上传、防重复校验、权限搜索的测试覆盖。
</details>

---

## 附录 (Appendix)
- **文档参考**：
  - [产品需求文档 (PRD)](docs/prd.md)
  - [架构设计文档](docs/architecture.md)
  - [数据库模型规约](docs/database-schema.md)
  - [API 生产规约](docs/api-spec.md)

- **术语解释**：
  - **前端**：用户在浏览器中看到和操作的界面层。
  - **后端**：处理业务逻辑、数据存储和安全验证的服务器程序。
  - **接口 (API)**：前后端或外部系统之间传递数据的约定。
  - **SLA**：服务水平协议，指任务应在多长时间内完成。
  - **幂等性**：同一请求重复执行多次，结果保持一致，避免重复开单或重复计费。
