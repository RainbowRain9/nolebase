# 页面：情绪分析

## 页面定位
情绪分析页面是MindGuard小程序的心理健康数据洞察中心，提供用户情绪状态的可视化分析和深度洞察。作为情绪-建议-任务闭环的分析输出端，通过多维度数据展示、趋势分析和智能洞察，帮助用户了解自己的情绪模式、识别影响因素、制定改善策略。页面支持弹窗快速查看和完整页面深度分析两种使用模式，满足不同场景的需求。

## 核心模块与组件

### 模块1：时间范围选择器
- **功能描述**：提供时间维度的切换控制，支持日、周、月、自定义时间范围，让用户在不同时间粒度下观察情绪变化趋势。
- **涉及组件**：时间切换按钮组、日期选择器、自定义范围选择器
- **交互说明**：
  - 默认显示"周"视图，提供日/周/月/自定义四个选项
  - 点击时间选项时，图表数据实时更新，带有平滑过渡动画
  - 自定义范围支持开始和结束日期选择，最大支持1年时间跨度
  - 显示当前选择的时间范围提示（如"2024年1月第2周"）

### 模块2：情绪趋势图表
- **功能描述**：以折线图形式展示情绪分值随时间的变化趋势，支持多维度数据叠加和交互式探索，是情绪分析的核心可视化组件。
- **涉及组件**：折线图组件、数据点标记、趋势线、对比基准线、图例控制器
- **交互说明**：
  - 主线展示情绪分值变化，支持悬浮显示具体数值和时间信息
  - 可叠加显示风险等级、能量指数、打卡频率等辅助数据
  - 支持双指缩放和拖拽平移，详细查看特定时间段
  - 点击数据点可查看该时间点的详细打卡记录
  - 提供趋势线拟合，展示情绪变化的整体方向

### 模块3：统计分析面板
- **功能描述**：提供当前时间范围内的情绪数据统计分析，包括分布特征、变化指标、对比分析等量化洞察。
- **涉及组件**：统计卡片组件、数据指标显示器、对比分析器、趋势指示器
- **交互说明**：
  - 展示关键指标：平均情绪分、最高/最低分、标准差、变化幅度
  - 情绪分布饼图：显示正向、中性、负向情绪的占比
  - 场景分析条形图：展示不同场景下的情绪分布
  - 对比分析：与上一周期、个人基线、群体平均的对比

### 模块4：关键词标签云
- **功能描述**：基于用户情绪记录中的备注内容，提取高频关键词并以可视化标签云形式展示，帮助用户快速了解情绪触发因素和关注焦点。
- **涉及组件**：标签云组件、关键词提取器、权重计算器、筛选控制器
- **交互说明**：
  - 词频权重：字体大小反映关键词出现频率，频率越高字体越大
  - 颜色分类：不同情绪类型的关键词使用不同颜色区分
  - 交互筛选：点击标签可筛选包含该关键词的记录
  - 悬浮提示：显示关键词出现次数和相关情绪分值

### 模块5：情绪洞察报告
- **功能描述**：基于AI算法分析用户情绪模式，提供个性化的洞察报告和改善建议，包含模式识别、风险预警、积极因素等分析维度。
- **涉及组件**：洞察卡片组件、AI分析结果展示、建议生成器、风险提示器
- **交互说明**：
  - 自动识别情绪模式：如"周末情绪较好"、"考试周压力增加"等
  - 风险因素识别：标记需要关注的情绪下降或异常波动
  - 积极因素发现：识别对情绪有积极影响的行为和环境
  - 个性化建议：基于分析结果提供具体的改善策略

### 模块6：详细记录列表
- **功能描述**：按时间顺序展示选定时间范围内的所有情绪打卡记录，支持筛选、搜索和详情查看。
- **涉及组件**：记录列表组件、筛选器、搜索框、详情展开器、编辑器
- **交互说明**：
  - 列表显示时间、情绪分值、主要标签、场景等关键信息
  - 支持按情绪类型、风险等级、场景标签进行筛选
  - 搜索功能支持在备注内容中查找关键词
  - 点击记录可展开查看完整信息和附件
  - 支持编辑最近的记录（24小时内）

### 模块7：导出与分享
- **功能描述**：提供情绪分析报告的导出和分享功能，支持生成PDF报告、数据导出和社交分享。
- **涉及组件**：导出按钮组、格式选择器、分享面板、报告生成器
- **交互说明**：
  - 支持导出PDF格式的情绪分析报告（包含图表和洞察）
  - 数据导出功能，支持CSV、Excel格式
  - 社交分享：生成简洁的图表截图和关键指标
  - 报告定制：选择包含的数据维度和时间范围

## AI / 智能分析逻辑

### 情绪模式识别
- **时间模式分析**：识别情绪的日变化、周变化、月变化模式，如"早上情绪较好"、"周末情绪提升"等
- **触发因素识别**：基于场景标签和备注内容，分析影响情绪的关键因素
- **周期性检测**：识别情绪波动的周期性规律，如"每月特定时间情绪低落"
- **异常模式发现**：检测与正常模式偏差较大的异常情绪状态

### 风险评估与预警
- **趋势分析**：分析情绪的长期趋势，识别持续下降或波动加剧的风险
- **阈值监控**：监控情绪分值跌破关键阈值的频率和持续时间
- **聚类分析**：识别高风险情绪模式的聚类特征
- **预警触发**：基于多维度指标综合评估，触发不同级别的风险预警

### 个性化洞察生成
- **基线对比**：与用户个人历史基线进行对比，评估当前状态的相对性
- **群体参考**：在保护隐私的前提下，提供匿名的群体对比参考
- **改善机会**：识别最容易改善的情绪维度和行为模式
- **资源推荐**：基于分析结果推荐相关的心理资源和活动

## 涉及组件

### 核心业务组件
- **MoodTrendChart**：情绪趋势图表组件，支持多维度数据展示和交互
- **TimeRangeSelector**：时间范围选择器，支持多种时间维度切换
- **StatisticsPanel**：统计分析面板，展示量化指标和分布特征
- **InsightReport**：洞察报告组件，展示AI分析结果和建议
- **RecordList**：详细记录列表，支持筛选、搜索和详情查看
- **ExportShare**：导出分享组件，支持报告生成和社交分享

### 图表组件
- **LineChart**：折线图组件，展示时间序列数据
- **PieChart**：饼图组件，展示情绪分布
- **BarChart**：条形图组件，展示场景对比和分布
- **ScatterChart**：散点图组件，展示情绪与其他因素的相关性
- **Heatmap**：热力图组件，展示情绪的时间和强度分布

### 交互组件
- **DataPointTooltip**：数据点悬浮提示，显示详细信息
- **ZoomController**：缩放控制器，支持图表的缩放和平移
- **FilterPanel**：筛选面板，支持多维度数据筛选
- **SearchBox**：搜索框，支持记录内容的搜索
- **DetailModal**：详情弹窗，显示记录的完整信息

### 状态组件
- **LoadingIndicator**：加载指示器，显示数据加载状态
- **EmptyState**：空状态提示，引导用户开始记录
- **ErrorAlert**：错误提示，显示数据加载或分析错误
- **SyncStatus**：同步状态指示器，显示数据同步状态

## 数据需求与存储

### 数据来源
- **主数据源**：`checkins` 集合，包含所有情绪打卡记录
- **用户画像**：`user_profiles` 集合，提供用户基线和偏好信息
- **任务数据**：`behavior_tasks` 集合，分析任务与情绪的关联
- **建议数据**：`recommendations` 集合，评估建议采纳效果
- **日志数据**：用户行为日志，用于模式分析和优化

### 数据处理需求
- **聚合计算**：按时间维度聚合情绪数据，计算统计指标
- **趋势分析**：计算情绪变化趋势、斜率、波动性等指标
- **模式识别**：应用机器学习算法识别情绪模式
- **对比分析**：与历史数据、基线、群体数据进行对比
- **洞察生成**：基于分析结果生成文字化的洞察报告

### 关键API接口
- **`GET /api/moods/analysis`**：获取情绪分析数据（支持时间范围和维度）
- **`GET /api/moods/trends`**：获取情绪趋势数据（支持不同时间粒度）
- **`GET /api/moods/statistics`**：获取情绪统计数据
- **`GET /api/moods/insights`**：获取AI洞察分析结果
- **`POST /api/moods/export`**：生成和导出分析报告
- **`GET /api/moods/records`**：获取详细记录列表（支持筛选和搜索）

## 页面跳转关系

### 从情绪分析页面跳出的链接
- **详细记录页**：点击记录列表中的具体记录，查看完整信息
- **情绪打卡页**：点击"记录新情绪"按钮，跳转到打卡界面
- **建议详情页**：点击洞察报告中的具体建议，查看详细信息
- **资源推荐页**：基于分析结果跳转到相关心理资源
- **报告分享页**：生成报告后的分享和保存页面

### 跳转到情绪分析页面的入口
- **今天Tab**：点击情绪状态卡上的"查看分析"或趋势图入口
- **个人中心**：点击"情绪分析"或"查看我的报告"
- **周报告知**：点击周报中的"查看详细分析"
- **任务完成**：某些情绪相关的任务完成后推荐查看分析
- **快捷入口**：桌面小组件或通知中的快捷链接

## 响应式设计

### 移动端适配
- **主布局**：单列布局，卡片式设计，支持垂直滚动
- **图表适配**：图表宽度自适应，高度根据内容动态调整
- **交互优化**：触控友好的交互元素，适当的点击区域大小
- **性能优化**：图表渲染优化，大数据量时的虚拟滚动

### 横屏模式
- **布局调整**：双列布局，充分利用屏幕宽度
- **图表扩展**：图表可以显示更多的数据点和时间范围
- **信息密度**：适当增加信息密度，提高数据展示效率

### 平板适配
- **布局优化**：根据屏幕大小调整列数和间距
- **组件扩展**：利用更大屏幕展示更丰富的信息
- **多任务**：支持分屏或悬浮窗口模式

## 埋点与分析

### 关键埋点事件
- **mood_analysis_view**：情绪分析页面查看
- **time_range_change**：时间范围切换
- **chart_interaction**：图表交互（缩放、平移、点击）
- **insight_view**：洞察报告查看
- **export_action**：报告导出和分享
- **filter_apply**：筛选器应用
- **record_detail_view**：详细记录查看

### 分析指标
- **使用频率**：情绪分析功能的使用频率和时长
- **时间维度偏好**：用户最常查看的时间范围
- **功能使用率**：各子功能的使用情况
- **洞察点击率**：AI洞察的点击和采纳情况
- **导出率**：报告导出和分享的比例

### 数据应用
- **产品优化**：基于使用数据优化页面布局和功能
- **算法改进**：通过用户反馈改进洞察分析算法
- **个性化推荐**：基于使用习惯推荐相关功能
- **用户分群**：根据使用行为进行用户分群和精准服务

## 技术实现要点

### 性能优化
- **数据缓存**：分析结果缓存，避免重复计算
- **图表优化**：采用Canvas或WebGL渲染大数据量图表
- **虚拟滚动**：记录列表的虚拟滚动，优化长列表性能
- **懒加载**：非关键内容的懒加载，提高首屏加载速度
- **离线支持**：支持离线查看最近的分析结果

### 数据安全
- **隐私保护**：严格保护用户情绪数据隐私
- **数据脱敏**：在群体对比中使用脱敏数据
- **权限控制**：用户只能访问自己的情绪数据
- **加密传输**：敏感数据传输加密
- **合规处理**：符合相关数据保护法规要求

### 用户体验
- **渐进式披露**：从概览到细节的渐进式信息展示
- **引导式设计**：为初次使用用户提供使用引导
- **错误恢复**：优雅的错误处理和恢复机制
- **无障碍访问**：支持屏幕阅读器和键盘导航
- **国际化支持**：支持多语言和地区适配