# 页面：学校协同（路径：miniprogram/packages/profile/school-cooperation/index）

## 1. 页面目标与角色
- 为校方心理辅导员/运营老师提供风险事件协同中枢，实现“AI预警 → 人工评估 → 干预指派 → 复盘闭环”。主流程：学校协同/安全治理（管理端入口在“我的”域内，仅权限用户可见）。

## 2. 入口与去向（导航）
- 入口来源：
  - pages/mine/index：角色=辅导员/管理员时显示“学校协同”入口
  - 风险事件通知（packages/community/message）点击进入对应事件详情
- 去向页面：
  - 事件详情抽屉（页内模块）
  - packages/tasks/task-detail：生成并指派干预任务 `?taskId=xxx`
  - packages/profile/report-detail：查看周报与统计 `?range=week`
- 路由示例：`wx.navigateTo({ url: '/packages/profile/school-cooperation/index' })`
- 分包关系：所属分包 packages/profile；被 pages/mine/index 预加载（preloadRule: all）。

## 3. 关键组件与交互
- 组件清单：FilterBar、StatsCard、CaseCard、StatusBadge、AssignmentModal、TimelineView、RiskIndicator（参考 docs/UI组件文档.md）。
- 交互描述：
  - 列表筛选（等级/校区/状态/时间）、排序（等级/时间/状态）、搜索（关键词）。
  - 详情抽屉：开始跟进/标记误报/升级处理/添加评估笔记。
  - 任务指派：模板选择、截止时间、优先级、执行说明；支持回退与二次确认。
  - 错误重试：接口失败时保留操作草稿，网络恢复后补提；列表骨架与空态。
- 无障碍与文案：
  - 管理端用语保持温和，避免对学生的价值判断；所有图标附可读文本。

## 4. 数据契约与接口
- 读取/写入：
  - 预警/统计：docs/数据库/集合-周报与风控.reports.md（筛选字段、处理状态）
  - 任务：docs/数据库/集合-任务.tasks.md（来源=intervention）
  - 用户与权限：docs/数据库/集合-用户.users.md（角色、组织）
- 接口占位：docs/接口占位文档.md（alerts/list/detail/update、tasks/create、authz/verify）
- Mock 策略：支持通过 `wx.getStorageSync('USE_MOCK')` 使用本地 fixtures 进行演示。

## 5. 埋点与观测（依据 docs/埋点与数据分析.md）
- 页面曝光：`pv_school_cooperation`（onShow）
- 关键点击：`clk_alert_card`（id, severity）、`clk_assign_task`（template, priority）
- 操作事件：`act_case_update`（action: start/review/escalate/close）、`act_intervention_assign`（task_id）
- 首屏完成：`exp_school_cooperation_first_paint`

## 6. 异常与边界
- 权限：越权访问直接拦截，提示登录或联系管理员；所有操作记录审计日志。
- 隐私：严格最小必要原则；仅在授权或合规条件下显示可识别信息。
- 弱网：只读降级；操作形成待办队列，恢复后重放。
- 性能：列表分页/虚拟化；图表按需渲染。

## 7. 验收清单（DoD）
- [ ] 角色鉴权与越权拦截
- [ ] 风险列表筛选/排序/搜索
- [ ] 事件详情抽屉操作完整（开始/误报/升级/备注）
- [ ] 任务指派成功并写入任务集合
- [ ] 埋点与首屏完成事件上报
- [ ] 错误重试与弱网降级体验
- [ ] 审计日志与隐私遮蔽
- 相关测试用例：docs/测试用例.md “学校协同-风控闭环/指派/审计”

## 8. 关联文档
- 功能文档：docs/功能文档/功能-学校协同系统.md、docs/功能文档/功能-SOS安全守护.md
- 数据库：docs/数据库/集合-周报与风控.reports.md、docs/数据库/集合-任务.tasks.md、docs/数据库/集合-用户.users.md
- 其他：docs/分包规划方案.md、docs/埋点与数据分析.md、docs/UI组件文档.md

## 9. 变更记录
- 2025-09-22 by Codex：按统一模板重写并对齐分包路径
