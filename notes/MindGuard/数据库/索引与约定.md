索引与约定

命名规范

集合名：小写复数（users, posts）

字段名：snake_case（例：last_checkin_at）

时间：ISO 字符串；同时保留毫秒时间戳字段（可选）


通用字段

_id（TCB 自动）

createdAt/updatedAt（服务端时间）

_openid（TCB 自动）、createdBy/updatedBy（业务标识）


类型映射

string/number/boolean/date/object/array/geo/指针id（引用其他集合的 _id）


隐私分级

P0 公开、P1 内部、P2 个人敏感（联系方式、位置）、P3 高敏（心理健康、医疗、SOS）


索引策略

高频查询字段必须建索引；范围查询配合时间索引

复合索引遵循“等值在前、范围在后”，覆盖排序字段


软删/合规

软删字段 isDeleted（bool）+ deletedAt

用户注销：events/journals/checkins 等按分级脱敏或删除；保留必要审计


版本规范

采用 semver：schema vMAJOR.MINOR.PATCH

每次变更写入《版本历史.md》，含迁移脚本要点
