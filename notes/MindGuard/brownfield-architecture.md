# MindGuard Brownfield æ¶æ„æ–‡æ¡£

> **é¡¹ç›®çŠ¶æ€**: åŠæˆå“å®Œå–„å¢å¼º | **ç‰ˆæœ¬**: v4.0 | **æ—¥æœŸ**: 2025-10-20
>
> **æ–‡æ¡£ç±»å‹**: Brownfield Enhancement Architecture | **ç»´æŠ¤è€…**: å“ˆé›·é…±å¤§å°å§

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ ˆç°çŠ¶](#æŠ€æœ¯æ ˆç°çŠ¶)
3. [æ ¸å¿ƒæ¨¡å—åˆ†æ](#æ ¸å¿ƒæ¨¡å—åˆ†æ)
4. [PRDéœ€æ±‚å¯¹åº”å…³ç³»](#prdéœ€æ±‚å¯¹åº”å…³ç³»)
5. [æŠ€æœ¯å€ºåŠ¡å’Œå·²çŸ¥é—®é¢˜](#æŠ€æœ¯å€ºåŠ¡å’Œå·²çŸ¥é—®é¢˜)
6. [é›†æˆç­–ç•¥](#é›†æˆç­–ç•¥)
7. [å¼€å‘å·¥ä½œæµ](#å¼€å‘å·¥ä½œæµ)
8. [å…³é”®æ–‡ä»¶æ˜ å°„](#å…³é”®æ–‡ä»¶æ˜ å°„)
9. [å®æ–½é£é™©è¯„ä¼°](#å®æ–½é£é™©è¯„ä¼°)

---

## ğŸ“– é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®ç®€ä»‹

**MindGuard** æ˜¯ä¸€ä¸ªé¢å‘é«˜æ ¡åœºæ™¯çš„å¿ƒç†å¥åº·æ”¯æŒå¾®ä¿¡å°ç¨‹åºï¼Œå½“å‰å¤„äº**åŠæˆå“å¼€å‘çŠ¶æ€**ï¼Œéœ€è¦ä»åŸºç¡€æ¶æ„å®Œå–„ä¸ºåŠŸèƒ½å®Œæ•´çš„å¿ƒç†å¥åº·æ”¯æŒå¹³å°ã€‚

### æ ¸å¿ƒåŠŸèƒ½é—­ç¯

é¡¹ç›®è®¾è®¡äº†"æƒ…ç»ªæ‰“å¡ â†’ AIå»ºè®® â†’ ä»»åŠ¡é—­ç¯ â†’ æ•ˆæœéªŒè¯"çš„å››é˜¶æ®µå¾ªç¯ï¼š

```
æƒ…ç»ªè®°å½• â†’ AIåˆ†æ â†’ ä¸ªæ€§åŒ–å»ºè®® â†’ ä»»åŠ¡æ‰§è¡Œ â†’ æ•ˆæœéªŒè¯ â†’ æƒ…ç»ªè®°å½•
```

### æŠ€æœ¯æ¶æ„æ¦‚è§ˆ

- **å‰ç«¯**: å¾®ä¿¡å°ç¨‹åºåŸç”Ÿæ¡†æ¶ + TDesign UIç»„ä»¶åº“
- **åç«¯**: å¾®ä¿¡äº‘å¼€å‘ (CloudBase)
- **AIæœåŠ¡**: Difyå·¥ä½œæµé›†æˆ
- **æ•°æ®åº“**: NoSQL (å¾®ä¿¡äº‘æ•°æ®åº“)
- **çŠ¶æ€**: å‰ç«¯æ¶æ„ç›¸å¯¹å®Œæ•´ï¼Œäº‘å‡½æ•°å¾…å®Œå–„

---

## ğŸ”§ æŠ€æœ¯æ ˆç°çŠ¶

### æ ¸å¿ƒæŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯ | ç‰ˆæœ¬ | çŠ¶æ€ | å¤‡æ³¨ |
|------|------|------|------|------|
| **å°ç¨‹åºæ¡†æ¶** | å¾®ä¿¡å°ç¨‹åºåŸç”Ÿ | 3.10.1 | âœ… å®Œæ•´ | åŸºç¡€åº“ç‰ˆæœ¬3.10.1 |
| **UIç»„ä»¶åº“** | TDesign Miniprogram | 1.10.1 | âœ… å®Œæ•´ | ç»Ÿä¸€è®¾è®¡è¯­è¨€ |
| **åç«¯æœåŠ¡** | å¾®ä¿¡äº‘å¼€å‘ | - | âš ï¸ éƒ¨åˆ†å®ç° | äº‘å‡½æ•°å¾…å®Œå–„ |
| **AIé›†æˆ** | Difyå·¥ä½œæµ | - | âš ï¸ é›†æˆä¸­ | éœ€è¦å®Œå–„ç¼–æ’ |
| **æ•°æ®åº“** | å¾®ä¿¡äº‘æ•°æ®åº“ | - | âœ… å®Œæ•´ | NoSQLé›†åˆè®¾è®¡ |
| **åŒ…ç®¡ç†** | npm | - | âœ… å®Œæ•´ | miniprogramç›®å½• |

### é¡¹ç›®é…ç½®ä¿¡æ¯

- **å°ç¨‹åºAppID**: wx3b23ed9a8ff5f5c6
- **äº‘å¼€å‘ç¯å¢ƒID**: cloud1-9gpfk3ie94d8630a
- **é¡¹ç›®æ ¹ç›®å½•**: miniprogram/
- **äº‘å‡½æ•°ç›®å½•**: cloudfunctions/
- **åˆ†åŒ…ç­–ç•¥**: ä¸»åŒ… + 5ä¸ªæ™®é€šåˆ†åŒ… + 2ä¸ªç‹¬ç«‹åˆ†åŒ…

---

## ğŸ—ï¸ æ ¸å¿ƒæ¨¡å—åˆ†æ

### 1. æƒ…ç»ªæ‰“å¡ç³»ç»Ÿ (P0ä¼˜å…ˆçº§)

**å½“å‰å®ç°çŠ¶æ€**: âš ï¸ åŸºç¡€æ¡†æ¶å®Œæˆï¼Œäº‘å‡½æ•°å¾…å®ç°

**å…³é”®æ–‡ä»¶**:
- å‰ç«¯é¡µé¢: [`miniprogram/pages/today/index.js`](miniprogram/pages/today/index.js)
- æœåŠ¡å±‚: [`miniprogram/services/checkins.js`](miniprogram/services/checkins.js)
- äº‘å‡½æ•°: [`cloudfunctions/checkinRecorder/index.js`](cloudfunctions/checkinRecorder/index.js) **æœªå®ç°**

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… 7ç§åŸºç¡€æƒ…ç»ªç±»å‹é€‰æ‹© (å¹³é™ã€å–œæ‚¦ã€ä¸“æ³¨ã€ä½è½ã€ç„¦è™‘ã€æ„¤æ€’ã€å€¦æ€ )
- âœ… 1-5çº§å¼ºåº¦è°ƒèŠ‚
- âœ… æ ‡ç­¾ç³»ç»Ÿ (æ ¡å›­ã€å®¤å‹ã€å®¶äººã€å­¦ä¹ ã€è¿åŠ¨ã€æœ‹å‹ã€è‡ªæˆ‘)
- âœ… æ–‡å­—å¤‡æ³¨åŠŸèƒ½
- âœ… å¿ƒæƒ…è½®ç»Ÿè®¡åŸºç¡€
- âš ï¸ äº‘å‡½æ•°æŒä¹…åŒ–å¾…å®ç°

**æ•°æ®æ¨¡å‹**:
```javascript
{
  mood: string,           // æƒ…ç»ªç±»å‹
  intensity: number,      // å¼ºåº¦ 1-5
  tags: string[],         // æ ‡ç­¾æ•°ç»„
  note: string,           // æ–‡å­—å¤‡æ³¨
  checkin_date: string,   // æ‰“å¡æ—¥æœŸ
  createdAt: string       // åˆ›å»ºæ—¶é—´
}
```

### 2. AIå¾®å»ºè®®ç”Ÿæˆç³»ç»Ÿ (P1ä¼˜å…ˆçº§)

**å½“å‰å®ç°çŠ¶æ€**: âš ï¸ Mockæ•°æ®å®Œæ•´ï¼ŒDifyé›†æˆå¾…å®ç°

**å…³é”®æ–‡ä»¶**:
- æœåŠ¡å±‚: [`miniprogram/services/suggestions.js`](miniprogram/services/suggestions.js)
- äº‘å‡½æ•°: [`cloudfunctions/suggestionOrchestrator/index.js`](cloudfunctions/suggestionOrchestrator/index.js) **æœªå®ç°**

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… Mockæ•°æ®ç»“æ„å®Œæ•´
- âœ… å»ºè®®åˆ†ç±» (å‘¼å¸ã€ç¤¾äº¤ã€ç¡çœ ã€æƒ…ç»ªç­‰)
- âœ… ä¼˜å…ˆçº§æ’åº
- âœ… æ—¶é•¿ä¼°ç®—
- âš ï¸ Difyå·¥ä½œæµé›†æˆå¾…å®ç°
- âš ï¸ ä¸ªæ€§åŒ–ç®—æ³•å¾…å®ç°

**AIå·¥ä½œæµè®¾è®¡**:
```
æƒ…ç»ªæ•°æ®åˆ†æ â†’ ä¸Šä¸‹æ–‡ç†è§£ â†’ ä¸ªæ€§åŒ–å»ºè®®ç”Ÿæˆ â†’ ä¼˜å…ˆçº§æ’åº â†’ ç”¨æˆ·æ¨é€
```

### 3. ç¤¾åŒºæ ‘æ´åŠŸèƒ½ (P0ä¼˜å…ˆçº§)

**å½“å‰å®ç°çŠ¶æ€**: âš ï¸ åŸºç¡€æ¶æ„å®Œæˆï¼Œæ ¸å¿ƒåŠŸèƒ½å¾…å®ç°

**å…³é”®æ–‡ä»¶**:
- å‰ç«¯é¡µé¢: [`miniprogram/pages/treehole/index.js`](miniprogram/pages/treehole/index.js)
- æœåŠ¡å±‚: [`miniprogram/services/forum.js`](miniprogram/services/forum.js)
- äº‘å‡½æ•°: [`cloudfunctions/postService/index.js`](cloudfunctions/postService/index.js)
- å†…å®¹å®¡æ ¸: [`cloudfunctions/treeholeModeration/index.js`](cloudfunctions/treeholeModeration/index.js)

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… é£é™©è¯†åˆ«ç®—æ³•åŸºç¡€æ¡†æ¶
- âœ… åŒ¿åå‘å¸ƒæœºåˆ¶
- âœ… äº’åŠ¨åŠŸèƒ½ (æŠ±æŠ±ã€è¯„è®º)
- âœ… è¯é¢˜åˆ†ç±»ç³»ç»Ÿ
- âš ï¸ å†…å®¹å®¡æ ¸äº‘å‡½æ•°å¾…å®ç°
- âš ï¸ é£é™©è¯„ä¼°å¾…å®Œå–„

**é£é™©ç­‰çº§ç³»ç»Ÿ**:
```javascript
// R1-R4 é£é™©ç­‰çº§
R1: è§‚å¯Ÿ (0-0.4åˆ†)
R2: å…³æ³¨ (0.4-0.7åˆ†)
R3: è­¦ç¤º (0.7-0.85åˆ†)
R4: å‡çº§ (>0.85åˆ†)
```

### 4. ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ (P2ä¼˜å…ˆçº§)

**å½“å‰å®ç°çŠ¶æ€**: âš ï¸ åŸºç¡€åŠŸèƒ½å®Œæ•´ï¼Œé«˜çº§ç‰¹æ€§å¾…å®ç°

**å…³é”®æ–‡ä»¶**:
- å‰ç«¯é¡µé¢: [`miniprogram/pages/tasks/index.js`](miniprogram/pages/tasks/index.js)
- æœåŠ¡å±‚: [`miniprogram/services/tasks.js`](miniprogram/services/tasks.js)
- äº‘å‡½æ•°: [`cloudfunctions/taskWorkflow/index.js`](cloudfunctions/taskWorkflow/index.js) **æœªå®ç°**

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… ä»»åŠ¡åˆ›å»ºå’ŒçŠ¶æ€ç®¡ç†
- âœ… ä»AIå»ºè®®è‡ªåŠ¨åˆ›å»ºä»»åŠ¡
- âœ… ä»»åŠ¡åˆ†ç±»å’Œä¼˜å…ˆçº§
- âœ… è¿›åº¦è·Ÿè¸ª
- âš ï¸ ä»»åŠ¡å·¥ä½œæµç¼–æ’å¾…å®ç°
- âš ï¸ æé†’æ¨é€å¾…å®ç°

**ä»»åŠ¡çŠ¶æ€æµè½¬**:
```
pending â†’ in_progress â†’ completed
   â†“
skipped/expired
```

---

## ğŸ¯ PRDéœ€æ±‚å¯¹åº”å…³ç³»

### Story 1.1: å®Œå–„æƒ…ç»ªæ‰“å¡ç³»ç»Ÿ (3ç‚¹ - ç®€å•) **P0**

**éœ€æ±‚**: å®Œå–„å¤šæƒ…ç»ªç±»å‹é€‰æ‹©å’Œå¼ºåº¦è°ƒèŠ‚ï¼Œç”Ÿæˆå¿ƒæƒ…è½®ç»Ÿè®¡

**å½“å‰çŠ¶æ€**: å‰ç«¯å®Œæ•´ï¼Œäº‘å‡½æ•°å¾…å®ç°
**å½±å“æ–‡ä»¶**:
- `cloudfunctions/checkinRecorder/index.js` - éœ€è¦å®ç°
- `miniprogram/services/checkins.js` - éœ€è¦é€‚é…çœŸå®API

**å·¥ä½œé‡ä¼°ç®—**: 2-3å¤©å¼€å‘ + 1å¤©æµ‹è¯•

### Story 1.2: å®ç°AIå¾®å»ºè®®ç”Ÿæˆå·¥ä½œæµ (8ç‚¹ - å¤æ‚) **P1**

**éœ€æ±‚**: é›†æˆDifyå·¥ä½œæµï¼Œç”Ÿæˆä¸ªæ€§åŒ–å»ºè®®

**å½“å‰çŠ¶æ€**: Mockå®Œæ•´ï¼ŒDifyé›†æˆå¾…å®ç°
**å½±å“æ–‡ä»¶**:
- `cloudfunctions/suggestionOrchestrator/index.js` - éœ€è¦å®ç°Difyé›†æˆ
- `miniprogram/services/suggestions.js` - éœ€è¦å®Œå–„é”™è¯¯å¤„ç†

**å·¥ä½œé‡ä¼°ç®—**: 5-7å¤©å¼€å‘ + 2å¤©æµ‹è¯•

### Story 1.3: å®Œå–„ç¤¾åŒºæ ‘æ´æ ¸å¿ƒåŠŸèƒ½ (5ç‚¹ - ä¸­ç­‰) **P0**

**éœ€æ±‚**: å®ç°å‘å¸–ã€äº’åŠ¨ã€é£é™©è¯†åˆ«ã€å†…å®¹å®¡æ ¸

**å½“å‰çŠ¶æ€**: åŸºç¡€æ¶æ„å®Œæ•´ï¼Œæ ¸å¿ƒäº‘å‡½æ•°å¾…å®ç°
**å½±å“æ–‡ä»¶**:
- `cloudfunctions/postService/index.js` - éœ€è¦å®Œå–„
- `cloudfunctions/treeholeModeration/index.js` - éœ€è¦å®ç°é£é™©è¯†åˆ«

**å·¥ä½œé‡ä¼°ç®—**: 3-4å¤©å¼€å‘ + 2å¤©æµ‹è¯•

### Story 1.4: å»ºç«‹ä»»åŠ¡ç®¡ç†å’Œæ‰§è¡Œé—­ç¯ (4ç‚¹ - ä¸­ç­‰) **P2**

**éœ€æ±‚**: ä»»åŠ¡åˆ›å»ºã€è·Ÿè¸ªã€ç»Ÿè®¡ã€æ¨é€

**å½“å‰çŠ¶æ€**: åŸºç¡€åŠŸèƒ½å®Œæ•´ï¼Œå·¥ä½œæµå¾…å®ç°
**å½±å“æ–‡ä»¶**:
- `cloudfunctions/taskWorkflow/index.js` - éœ€è¦å®ç°ä»»åŠ¡ç¼–æ’é€»è¾‘

**å·¥ä½œé‡ä¼°ç®—**: 2-3å¤©å¼€å‘ + 1å¤©æµ‹è¯•

---

## âš ï¸ æŠ€æœ¯å€ºåŠ¡å’Œå·²çŸ¥é—®é¢˜

### å…³é”®æŠ€æœ¯å€ºåŠ¡

1. **äº‘å‡½æ•°å®ç°ä¸å®Œæ•´** (é«˜é£é™©)
   - 18ä¸ªäº‘å‡½æ•°ä¸­å¤§éƒ¨åˆ†ä»…è¿”å›"Not implemented"
   - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ (checkinRecorder, suggestionOrchestrator, taskWorkflow) å¾…å®ç°
   - å½±å“: æ— æ³•å®Œæˆå®Œæ•´çš„åŠŸèƒ½é—­ç¯

2. **AIé›†æˆç¼ºå¤±** (é«˜é£é™©)
   - Difyå·¥ä½œæµé›†æˆä»…åœ¨è§„åˆ’é˜¶æ®µ
   - æƒ…ç»ªåˆ†æç®—æ³•å¾…å®ç°
   - ä¸ªæ€§åŒ–æ¨èå¼•æ“å¾…å¼€å‘

3. **æ•°æ®ä¸€è‡´æ€§é—®é¢˜** (ä¸­é£é™©)
   - å‰ç«¯Mockæ•°æ®ä¸åç«¯æ•°æ®æ¨¡å‹ä¸å®Œå…¨ä¸€è‡´
   - å­—æ®µæ˜ å°„éœ€è¦æ ‡å‡†åŒ–
   - æ•°æ®è¿ç§»ç­–ç•¥å¾…åˆ¶å®š

### æ€§èƒ½å’Œæ‰©å±•æ€§é—®é¢˜

1. **åˆ†åŒ…åŠ è½½æ€§èƒ½**
   - åˆ†åŒ…åŠ è½½é”™è¯¯å¤„ç†ä¸å®Œå–„
   - ç½‘ç»œå¼‚å¸¸æ—¶ç”¨æˆ·ä½“éªŒå¾…ä¼˜åŒ–

2. **ç¼“å­˜ç­–ç•¥ç¼ºå¤±**
   - AIå»ºè®®æ— æœ¬åœ°ç¼“å­˜æœºåˆ¶
   - ç¦»çº¿åŠŸèƒ½æ”¯æŒä¸å®Œæ•´

### å®‰å…¨å’Œéšç§é—®é¢˜

1. **æ•°æ®å®‰å…¨**
   - æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨å¾…å®ç°
   - ç”¨æˆ·éšç§ä¿æŠ¤æœºåˆ¶å¾…å®Œå–„

2. **é£é™©å†…å®¹å¤„ç†**
   - é«˜é£é™©å†…å®¹è¯†åˆ«ç®—æ³•å¾…ä¼˜åŒ–
   - å±æœºå¹²é¢„æµç¨‹å¾…å®ç°

---

## ğŸ”— é›†æˆç­–ç•¥

### æ•°æ®åº“é›†æˆç­–ç•¥

**ç°æœ‰é›†åˆç»“æ„**:
```
users/           # ç”¨æˆ·ä¿¡æ¯
checkins/        # æƒ…ç»ªæ‰“å¡è®°å½•
journals/        # æ—¥è®°å†…å®¹
forum_posts/     # ç¤¾åŒºå¸–å­
behavior_tasks/  # ä»»åŠ¡æ•°æ®
suggestions/     # AIå»ºè®®
ask_sessions/    # AIå¯¹è¯ä¼šè¯
```

**æ–°å­—æ®µæ·»åŠ ç­–ç•¥**:
- ä¸ºcheckinsé›†åˆæ·»åŠ emotion_intensityå­—æ®µ
- ä¸ºsuggestionsé›†åˆæ·»åŠ personalization_scoreå­—æ®µ
- ä¸ºbehavior_tasksé›†åˆæ·»åŠ reminder_settingså­—æ®µ

### APIé›†æˆç­–ç•¥

**ç»Ÿä¸€è¿”å›æ ¼å¼**:
```javascript
{
  ok: boolean,        // æˆåŠŸæ ‡è¯†
  data: any,          // è¿”å›æ•°æ®
  error?: string,     // é”™è¯¯ä¿¡æ¯
  code?: number       // é”™è¯¯ä»£ç 
}
```

**äº‘å‡½æ•°å‘½åè§„èŒƒ**:
- åŠŸèƒ½æ¨¡å— + Recorder (è®°å½•ç±»)
- åŠŸèƒ½æ¨¡å— + Orchestrator (ç¼–æ’ç±»)
- åŠŸèƒ½æ¨¡å— + Workflow (å·¥ä½œæµç±»)

### AIæœåŠ¡é›†æˆ

**Difyå·¥ä½œæµè®¾è®¡**:
```
1. æƒ…ç»ªåˆ†æå·¥ä½œæµ: checkin_data â†’ emotion_analysis â†’ mood_insights
2. å»ºè®®ç”Ÿæˆå·¥ä½œæµ: mood_insights + user_context â†’ personalized_suggestions
3. é£é™©è¯„ä¼°å·¥ä½œæµ: content_analysis â†’ risk_score â†’ intervention_strategy
```

---

## ğŸ”„ å¼€å‘å·¥ä½œæµ

### æœ¬åœ°å¼€å‘ç¯å¢ƒ

1. **å¾®ä¿¡å¼€å‘è€…å·¥å…·é…ç½®**
   - åŸºç¡€åº“ç‰ˆæœ¬: 3.10.1
   - äº‘å¼€å‘ç¯å¢ƒ: cloud1-9gpfk3ie94d8630a
   - ä¸æ ¡éªŒåˆæ³•åŸŸå: å¼€å‘é˜¶æ®µå¯ç”¨

2. **Mockæ•°æ®å¼€å…³**
   ```javascript
   // miniprogram/utils/request.js
   const USE_MOCK = wx.getStorageSync('USE_MOCK') || true;
   ```

3. **è°ƒè¯•å·¥å…·**
   - å¾®ä¿¡å¼€å‘è€…å·¥å…·äº‘å‡½æ•°æœ¬åœ°è°ƒè¯•
   - ç½‘ç»œé¢æ¿æ£€æŸ¥APIè°ƒç”¨
   - æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

### ä»£ç è§„èŒƒ

**å‘½åè§„èŒƒ**:
- æ–‡ä»¶: kebab-case (emotion-checkin.js)
- å‡½æ•°: camelCase (validateEmotionData)
- æ•°æ®åº“å­—æ®µ: snake_case (emotion_intensity)
- ç»„ä»¶: PascalCase (EmotionPicker)

**ä»£ç è´¨é‡è¦æ±‚**:
- ä¸¥æ ¼æ¨¡å¼: `'use strict';`
- å¼‚æ­¥å¤„ç†: ç»Ÿä¸€ä½¿ç”¨ `async/await`
- é”™è¯¯å¤„ç†: å®Œæ•´çš„ try-catch-finally ç»“æ„
- æ³¨é‡Šè§„èŒƒ: JSDoc æ ¼å¼

### æµ‹è¯•ç­–ç•¥

**å½“å‰æµ‹è¯•çŠ¶æ€**: âŒ æ— æµ‹è¯•è¦†ç›–

**å»ºè®®æµ‹è¯•ç»“æ„**:
```
tests/
â”œâ”€â”€ unit/           # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ services/   # æœåŠ¡å±‚æµ‹è¯•
â”‚   â””â”€â”€ utils/      # å·¥å…·å‡½æ•°æµ‹è¯•
â”œâ”€â”€ integration/    # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ api/        # APIæ¥å£æµ‹è¯•
â””â”€â”€ e2e/           # ç«¯åˆ°ç«¯æµ‹è¯•
    â””â”€â”€ user-journey/ # ç”¨æˆ·æ—…ç¨‹æµ‹è¯•
```

---

## ğŸ“ å…³é”®æ–‡ä»¶æ˜ å°„

### æ ¸å¿ƒé¡µé¢æ–‡ä»¶

| åŠŸèƒ½æ¨¡å— | é¡µé¢æ–‡ä»¶ | æœåŠ¡æ–‡ä»¶ | äº‘å‡½æ•° | çŠ¶æ€ |
|---------|---------|---------|---------|------|
| **æƒ…ç»ªæ‰“å¡** | [`pages/today/index.js`](miniprogram/pages/today/index.js) | [`services/checkins.js`](miniprogram/services/checkins.js) | [`checkinRecorder`](cloudfunctions/checkinRecorder/index.js) | âš ï¸ äº‘å‡½æ•°å¾…å®ç° |
| **AIå»ºè®®** | - | [`services/suggestions.js`](miniprogram/services/suggestions.js) | [`suggestionOrchestrator`](cloudfunctions/suggestionOrchestrator/index.js) | âš ï¸ äº‘å‡½æ•°å¾…å®ç° |
| **ç¤¾åŒºæ ‘æ´** | [`pages/treehole/index.js`](miniprogram/pages/treehole/index.js) | [`services/forum.js`](miniprogram/services/forum.js) | [`postService`](cloudfunctions/postService/index.js) | âš ï¸ éƒ¨åˆ†å¾…å®ç° |
| **ä»»åŠ¡ç®¡ç†** | [`pages/tasks/index.js`](miniprogram/pages/tasks/index.js) | [`services/tasks.js`](miniprogram/services/tasks.js) | [`taskWorkflow`](cloudfunctions/taskWorkflow/index.js) | âš ï¸ äº‘å‡½æ•°å¾…å®ç° |
| **SOSæ±‚åŠ©** | [`independent/sos/index.js`](miniprogram/independent/sos/index/index.js) | - | [`sosRelay`](cloudfunctions/sosRelay/index.js) | âš ï¸ å¾…å®ç° |

### åˆ†åŒ…ç»“æ„

```
miniprogram/
â”œâ”€â”€ packages/              # æ™®é€šåˆ†åŒ…
â”‚   â”œâ”€â”€ community/         # ç¤¾åŒºåŠŸèƒ½ (13ä¸ªé¡µé¢)
â”‚   â”œâ”€â”€ journal/          # æ—¥è®°åŠŸèƒ½ (4ä¸ªé¡µé¢)
â”‚   â”œâ”€â”€ profile/          # ä¸ªäººä¸­å¿ƒ (9ä¸ªé¡µé¢)
â”‚   â”œâ”€â”€ tasks/            # ä»»åŠ¡è¯¦æƒ… (1ä¸ªé¡µé¢)
â”‚   â”œâ”€â”€ breath/           # å‘¼å¸ç»ƒä¹  (1ä¸ªé¡µé¢)
â”‚   â””â”€â”€ mindfulness/      # æ­£å¿µå†¥æƒ³ (1ä¸ªé¡µé¢)
â””â”€â”€ independent/          # ç‹¬ç«‹åˆ†åŒ…
    â”œâ”€â”€ sos/             # SOSç´§æ€¥æ±‚åŠ© (2ä¸ªé¡µé¢)
    â””â”€â”€ heartchat/       # å¿ƒè¯­ç²¾çµ (1ä¸ªé¡µé¢)
```

### å·¥å…·å’Œé…ç½®æ–‡ä»¶

- **è¯·æ±‚å·¥å…·**: [`miniprogram/utils/request.js`](miniprogram/utils/request.js)
- **é¥æµ‹å·¥å…·**: [`miniprogram/utils/telemetry.js`](miniprogram/utils/telemetry.js)
- **é¡µé¢é€‚é…**: [`miniprogram/utils/page-adapter.js`](miniprogram/utils/page-adapter.js)
- **é¡¹ç›®é…ç½®**: [`project.config.json`](project.config.json)
- **äº‘å¼€å‘é…ç½®**: [`cloudbaserc.json`](cloudbaserc.json)

---

## âš¡ å®æ–½é£é™©è¯„ä¼°

### é«˜é£é™©é¡¹

1. **Difyé›†æˆé£é™©** (é«˜é£é™©)
   - **é£é™©**: AIæœåŠ¡å“åº”æ—¶é—´å’Œç¨³å®šæ€§ä¸å¯æ§
   - **ç¼“è§£**: å®ç°æœ¬åœ°ç¼“å­˜å’Œé™çº§æœºåˆ¶
   - **åº”æ€¥é¢„æ¡ˆ**: å‡†å¤‡é™æ€å»ºè®®åº“ä½œä¸ºå¤‡é€‰

2. **äº‘å‡½æ•°å¼€å‘é£é™©** (é«˜é£é™©)
   - **é£é™©**: æ ¸å¿ƒäº‘å‡½æ•°å¼€å‘å·¥ä½œé‡å¯èƒ½è¢«ä½ä¼°
   - **ç¼“è§£**: æŒ‰ä¼˜å…ˆçº§åˆ†é˜¶æ®µå®ç°ï¼Œå…ˆå®ç°MVP
   - **åº”æ€¥é¢„æ¡ˆ**: ä¸´æ—¶ä½¿ç”¨Mockæ•°æ®ä¿è¯åŸºç¡€åŠŸèƒ½

3. **æ•°æ®ä¸€è‡´æ€§é£é™©** (ä¸­é£é™©)
   - **é£é™©**: å‰åç«¯æ•°æ®æ ¼å¼ä¸ä¸€è‡´å¯¼è‡´åŠŸèƒ½å¼‚å¸¸
   - **ç¼“è§£**: å»ºç«‹å®Œæ•´çš„æ•°æ®æ¨¡å‹æ–‡æ¡£å’Œè½¬æ¢å±‚
   - **åº”æ€¥é¢„æ¡ˆ**: å®ç°æ•°æ®è¿ç§»å’Œä¿®å¤å·¥å…·

### ä¸­é£é™©é¡¹

1. **æ€§èƒ½é£é™©** (ä¸­é£é™©)
   - **é£é™©**: AIåŠŸèƒ½å¯èƒ½å½±å“æ•´ä½“å“åº”é€Ÿåº¦
   - **ç¼“è§£**: å¼‚æ­¥å¤„ç†å’Œæ™ºèƒ½é¢„åŠ è½½
   - **ç›‘æ§æŒ‡æ ‡**: é¡µé¢åŠ è½½æ—¶é—´ < 2ç§’ï¼ŒAPIå“åº” < 500ms

2. **ç”¨æˆ·ä½“éªŒé£é™©** (ä¸­é£é™©)
   - **é£é™©**: åŠŸèƒ½ä¸å®Œæ•´å½±å“ç”¨æˆ·ç•™å­˜
   - **ç¼“è§£**: æ¸è¿›å¼åŠŸèƒ½å‘å¸ƒï¼ŒåŠæ—¶æ”¶é›†ç”¨æˆ·åé¦ˆ
   - **ç›‘æ§æŒ‡æ ‡**: ç”¨æˆ·æ»¡æ„åº¦ > 4.0/5.0

### ä½é£é™©é¡¹

1. **å…¼å®¹æ€§é£é™©** (ä½é£é™©)
   - **é£é™©**: å¾®ä¿¡å°ç¨‹åºå¹³å°å˜æ›´
   - **ç¼“è§£**: åŠæ—¶å…³æ³¨å¹³å°æ›´æ–°ï¼Œé¢„ç•™é€‚é…æ—¶é—´
   - **ç›‘æ§æŒ‡æ ‡**: å…¼å®¹æ€§è¦†ç›–98%ç”¨æˆ·

---

## ğŸ“ˆ æˆåŠŸæŒ‡æ ‡å’ŒéªŒæ”¶æ ‡å‡†

### æŠ€æœ¯æŒ‡æ ‡

- **æ€§èƒ½**: é¡µé¢åŠ è½½æ—¶é—´ < 2ç§’ï¼ŒAPIå“åº”æ—¶é—´ < 500ms
- **ç¨³å®šæ€§**: ç³»ç»Ÿå¯ç”¨ç‡ > 99%ï¼Œé”™è¯¯ç‡ < 0.1%
- **å…¼å®¹æ€§**: æ”¯æŒå¾®ä¿¡7.0+ç‰ˆæœ¬ï¼Œè¦†ç›–98%ç”¨æˆ·

### ä¸šåŠ¡æŒ‡æ ‡

- **åŠŸèƒ½å®Œæ•´æ€§**: æ‰€æœ‰P0/P1åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- **ç”¨æˆ·ä½“éªŒ**: ç”¨æˆ·æ»¡æ„åº¦ > 4.0/5.0
- **æ•°æ®å‡†ç¡®æ€§**: æƒ…ç»ªè¯†åˆ«å‡†ç¡®ç‡ > 85%ï¼ŒAIå»ºè®®ç›¸å…³æ€§ > 80%

### è´¨é‡æŒ‡æ ‡

- **ä»£ç è¦†ç›–ç‡**: æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•è¦†ç›–ç‡ > 80%
- **å®‰å…¨åˆè§„**: é€šè¿‡éšç§åˆè§„å®¡æŸ¥ï¼Œæ•°æ®åŠ å¯†ç‡100%
- **æ–‡æ¡£å®Œæ•´**: æ‰€æœ‰APIæ¥å£æ–‡æ¡£å®Œæ•´ï¼Œéƒ¨ç½²æ–‡æ¡£é½å…¨

---

## ğŸ› ï¸ å¼€å‘ä¼˜å…ˆçº§å»ºè®®

åŸºäºPRDéœ€æ±‚å’ŒæŠ€æœ¯å€ºåŠ¡åˆ†æï¼Œå»ºè®®æŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§è¿›è¡Œå¼€å‘ï¼š

### Phase 1: æ ¸å¿ƒåŠŸèƒ½å®ç° (Week 1-2)
1. **å®Œå–„æƒ…ç»ªæ‰“å¡ç³»ç»Ÿ** - å®ç°checkinRecorderäº‘å‡½æ•°
2. **ç¤¾åŒºæ ‘æ´åŸºç¡€åŠŸèƒ½** - å®Œå–„postServiceäº‘å‡½æ•°
3. **åŸºç¡€é£é™©è¯†åˆ«** - å®ç°treeholeModerationäº‘å‡½æ•°

### Phase 2: AIèƒ½åŠ›é›†æˆ (Week 3-4)
1. **Difyå·¥ä½œæµé›†æˆ** - å®ç°suggestionOrchestratoräº‘å‡½æ•°
2. **ä¸ªæ€§åŒ–å»ºè®®ç®—æ³•** - ä¼˜åŒ–å»ºè®®ç”Ÿæˆé€»è¾‘
3. **ä»»åŠ¡å·¥ä½œæµ** - å®ç°taskWorkflowäº‘å‡½æ•°

### Phase 3: å®Œå–„å’Œä¼˜åŒ– (Week 5)
1. **æ€§èƒ½ä¼˜åŒ–** - å®ç°ç¼“å­˜å’Œé¢„åŠ è½½
2. **æµ‹è¯•å’Œæ–‡æ¡£** - è¡¥å……æµ‹è¯•è¦†ç›–å’ŒAPIæ–‡æ¡£
3. **å‘å¸ƒå‡†å¤‡** - ç”Ÿäº§ç¯å¢ƒé…ç½®å’Œç›‘æ§

---

**æ–‡æ¡£ç»´æŠ¤**: æœ¬æ–‡æ¡£éœ€è¦éšå¼€å‘è¿›å±•æŒç»­æ›´æ–°ï¼Œå»ºè®®æ¯æ¬¡é‡Œç¨‹ç¢‘å®Œæˆåè¿›è¡Œå›é¡¾å’Œä¿®è®¢ã€‚

**è”ç³»æ–¹å¼**: å¦‚æœ‰æ¶æ„ç›¸å…³é—®é¢˜ï¼Œè¯·è”ç³»æŠ€æœ¯è´Ÿè´£äººæˆ–å‚è€ƒ[CLAUDE.md](CLAUDE.md)é¡¹ç›®å…¨æ™¯æ–‡æ¡£ã€‚

---

> **æ–‡æ¡£ç»“æŸ** | ä¸‹æ¬¡æ›´æ–°: æ ¹æ®å¼€å‘è¿›å±•æŒç»­æ›´æ–°
>
> **æ³¨æ„äº‹é¡¹**: æœ¬é¡¹ç›®ä¸ºBrownfieldå¢å¼ºï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­éœ€è¦ç‰¹åˆ«å…³æ³¨ç°æœ‰åŠŸèƒ½çš„å…¼å®¹æ€§å’Œæ•°æ®è¿ç§»é—®é¢˜ã€‚