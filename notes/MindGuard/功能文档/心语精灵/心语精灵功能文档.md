# 心语精灵 (HeartChat) 功能文档

## 功能概述

心语精灵是MindGuard的AI心理助手，基于认知行为疗法（CBT）等专业心理学理论，为用户提供即时对话、情绪疏导与行动建议。

## 功能特色

### 1. 多Agent切换系统

#### CBT助手
- **角色**: 认知行为疗法专家
- **专长**: 认知重构、证据检验、替代思维生成
- **适用场景**: 负面思维、认知扭曲、行为模式改变

#### 情绪顾问
- **角色**: 情绪识别与管理专家
- **专长**: 情绪识别、情绪调节、情绪接纳
- **适用场景**: 情绪困扰、情绪管理、压力调节

#### 行为导师
- **角色**: 行为激活与改变专家
- **专长**: 行为实验、习惯养成、渐进式暴露
- **适用场景**: 行为改变、习惯培养、目标设定

#### 危机干预
- **角色**: 紧急心理支持专家
- **专长**: 危机评估、紧急干预、资源连接
- **适用场景**: 心理危机、紧急情况、高风险状态

### 2. 对话功能

#### 消息界面
- **AI消息**: 左侧显示，包含Agent头像和专业回复
- **用户消息**: 右侧显示，包含用户头像和发送内容
- **消息时间**: 每条消息显示发送时间
- **滚动加载**: 支持历史消息加载

#### 输入功能
- **文本输入**: 支持多行文本输入
- **快速发送**: 支持回车键发送
- **输入提示**: 动态提示当前Agent名称

### 3. 快速建议

#### 启动建议
- 页面加载时显示快速建议
- 提供5个常见问题模板
- 点击即可使用建议内容

#### 建议内容
- 情绪相关问题
- 人际关系问题
- 学业压力问题
- 自我认知问题
- 生活习惯问题

### 4. 交互体验

#### Agent切换
- 底部工具栏显示所有Agent
- 横向滚动支持
- 实时切换，即时生效
- 切换时发送欢迎消息

#### 导航功能
- 记录功能：保存对话、导出对话、分享对话
- 设置功能：提醒设置、使用指南、反馈问题
- 更多功能：关于心语精灵

## 技术实现

### 1. 页面结构

```
/independent/heartchat/index/
├── index.wxml    # 页面结构
├── index.js      # 页面逻辑
├── index.wxss    # 页面样式
└── index.json    # 页面配置
```

### 2. 核心功能

#### 消息管理
- 消息对象：`{ id, type, content, time, agentId }`
- 消息类型：`'ai' | 'user'`
- 时间格式化：智能时间显示

#### Agent管理
- Agent对象：`{ id, name, description, avatar, welcomeMessage }`
- 动态切换：实时更新当前Agent
- 个性化欢迎：每个Agent独特的欢迎消息

#### 响应生成
- 模拟AI回复：基于Agent类型生成个性化回复
- 延迟处理：模拟真实对话体验
- 后续扩展：支持接入真实AI API

### 3. 样式设计

#### 视觉风格
- 主色调：紫色渐变 (#9333EA → #C084FC)
- 辅助色：白色背景、灰色文字
- 圆角设计：统一的圆角风格

#### 交互反馈
- 点击效果：按钮缩放、颜色变化
- 加载状态：打字动画、加载指示器
- 滚动优化：平滑滚动、底部对齐

### 4. 性能优化

#### 分包策略
- 独立分包：`independent/heartchat`
- 预加载规则：今天页面预加载
- 网络优化：WiFi环境下预加载

#### 内存管理
- 消息列表：限制历史消息数量
- 图片资源：优化Agent头像大小
- 事件监听：合理使用生命周期

## 后续扩展

### 1. AI集成
- Dify工作流集成
- 个性化回复优化
- 多轮对话管理

### 2. 功能增强
- 语音输入支持
- 消息类型扩展（图片、音频）
- 对话记录云同步

### 3. 数据分析
- 对话效果分析
- 用户偏好学习
- 个性化推荐

### 4. 安全隐私
- 对话内容加密
- 数据匿名化处理
- 用户权限控制

## 使用场景

### 1. 日常心理支持
- 情绪调节指导
- 压力管理建议
- 人际关系咨询

### 2. 危机干预
- 紧急心理支持
- 风险评估引导
- 专业资源连接

### 3. 自我成长
- 认知重构练习
- 行为习惯培养
- 心理技能学习

## 注意事项

### 1. 使用限制
- 本版本为模拟对话，非真实AI
- 危机情况请及时联系专业人士
- 对话内容仅供参考，不替代专业治疗

### 2. 隐私保护
- 对话内容本地存储
- 不会上传个人信息
- 用户完全控制数据

### 3. 技术要求
- 微信小程序环境
- 网络连接支持
- 基础设备性能