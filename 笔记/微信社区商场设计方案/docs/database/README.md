# 🗄️ 数据库设计文档系列

## 📋 文档概述

本系列文档详细描述了微信社区商场小程序的数据库设计方案，主要基于**MongoDB云数据库**，同时提供传统数据库设计作为参考对比。

### 技术架构
- **主要方案**: MongoDB 云数据库 (微信小程序云开发)
- **参考方案**: MySQL 传统数据库
- **数据访问**: 云函数 + 小程序端SDK
- **权限控制**: 基于 openid 的自动权限验证

## 📚 文档列表

### ☁️ [云数据库结构设计](cloud-schema.md) 🔥 **主要方案**
**数据库类型**: MongoDB 文档数据库  
**集合数量**: 14个核心集合  
**核心特性**:
- 灵活的文档结构设计
- 实时数据同步
- 自动扩容和备份
- 基于角色的权限控制

**主要集合**:
- `users` - 用户基础信息
- `products` - 商品信息
- `orders` - 订单数据
- `forum_posts` - 论坛帖子
- `academic_courses` - 课程信息

**适用场景**: 微信小程序云开发项目 (推荐使用)

### 📖 [传统数据库设计](schema.md) **参考方案**
**数据库类型**: MySQL 关系型数据库  
**数据表数量**: 43个数据表  
**核心特性**:
- 严格的关系型结构
- ACID事务支持
- 复杂查询优化
- 传统的外键约束

**主要数据表**:
- `users` - 用户基础信息表
- `products` - 商品信息表
- `orders` - 订单表
- `forum_posts` - 帖子表
- `academic_courses` - 课程表

**适用场景**: 传统Web应用、技术对比参考

### 🔄 [数据库迁移指南](migration.md)
**版本数量**: 8个版本  
**核心功能**:
- 数据库版本管理
- 结构变更脚本
- 数据迁移策略
- 回滚方案

**主要内容**:
- 版本升级脚本
- 数据迁移工具
- 兼容性处理
- 性能优化建议

**适用场景**: 数据库版本升级、结构变更

## 🔄 技术方案对比

### MongoDB 云数据库 vs MySQL 传统数据库

| 特性对比 | MongoDB 云数据库 🔥 | MySQL 传统数据库 📖 |
|---------|-------------------|-------------------|
| **数据结构** | 灵活的文档结构 | 固定的表结构 |
| **扩展性** | 自动水平扩展 | 需要手动分库分表 |
| **开发效率** | 快速迭代开发 | 需要严格设计 |
| **运维成本** | 零运维 | 需要专业运维 |
| **查询能力** | 文档查询 + 聚合 | SQL复杂查询 |
| **事务支持** | 文档级事务 | 完整ACID事务 |
| **学习成本** | 较低 | 较高 |
| **适用场景** | 小程序、快速开发 | 企业级应用 |

### 推荐选择

- **🔥 推荐使用**: MongoDB 云数据库
  - 适合小程序项目
  - 开发效率高
  - 运维成本低
  - 与微信生态深度集成

- **📖 参考学习**: MySQL 传统数据库
  - 了解关系型数据库设计
  - 技术对比和学习
  - 企业级项目参考

## 🚀 快速开始

### MongoDB 云数据库操作示例

```javascript
// 在云函数中操作数据库
const db = wx.cloud.database()

// 查询数据
const result = await db.collection('users').where({
  openid: event.userInfo.openId
}).get()

// 添加数据
await db.collection('users').add({
  data: {
    openid: event.userInfo.openId,
    nickname: '用户昵称',
    createdAt: new Date()
  }
})

// 更新数据
await db.collection('users').doc(userId).update({
  data: {
    nickname: '新昵称',
    updatedAt: new Date()
  }
})
```

### 权限规则配置示例

```json
{
  "read": "auth.openid == resource.data.openid",
  "write": "auth.openid == resource.data.openid"
}
```

## 📖 设计原则

### MongoDB 云数据库设计原则

1. **文档化设计**
   - 利用文档数据库的灵活性
   - 合理嵌套相关数据
   - 避免过度嵌套

2. **性能优化**
   - 合理设计索引策略
   - 优化查询模式
   - 控制文档大小

3. **权限控制**
   - 基于用户角色的权限设计
   - 数据隔离和安全
   - 最小权限原则

4. **扩展性考虑**
   - 预留扩展字段
   - 版本兼容性
   - 数据迁移友好

### 传统数据库设计原则

1. **规范化设计**
   - 遵循第三范式
   - 减少数据冗余
   - 保证数据一致性

2. **性能优化**
   - 合理设计索引
   - 优化查询语句
   - 分库分表策略

3. **约束完整性**
   - 外键约束
   - 检查约束
   - 唯一性约束

## 🔍 常见问题

**Q: 为什么选择MongoDB而不是MySQL？**  
A: MongoDB云数据库更适合小程序开发，具有零运维、自动扩容、与微信生态深度集成等优势。

**Q: 如何处理复杂查询？**  
A: MongoDB支持强大的聚合管道，可以实现复杂的数据查询和统计。

**Q: 数据安全如何保证？**  
A: 云数据库提供自动备份、权限控制、数据加密等安全特性。

**Q: 如何进行数据迁移？**  
A: 参考[数据库迁移指南](migration.md)，提供完整的迁移策略和工具。

## 🔗 相关文档

- [API接口文档系列](../api/README.md) - 了解数据库操作接口
- [云开发环境搭建](../deployment/cloud-setup.md) - 数据库环境配置
- [编码规范](../development/coding-standards.md) - 数据库操作规范
- [测试指南](../development/testing.md) - 数据库测试方法

## 📝 更新记录

- **2025年5月**: 完成云数据库设计，统一为MongoDB方案
- **集合总数**: 14个核心集合
- **技术架构**: 统一为微信小程序云开发方案
- **参考文档**: 保留MySQL设计作为技术对比

---

*最后更新时间: 2025年5月*
