# 功能扩展方案（社区先行版）

## 1. 设计定位
- 目标：以社区为主、AI 为支撑，把“日常记录 → 微行动 → 社区互助 → 风险守护”串成闭环。
- 原则：设计优先、AI 适度介入；微习惯驱动渐进改善；行为与情绪都有可复盘的数据；隐私保护前置。
- 范围：面向小程序/Web 客户端，沿用“今天｜日记｜树洞｜我的”导航与双态悬浮按钮。

## 2. 功能矩阵
> 括号标注推荐的 AI 介入力度：无｜轻｜中｜重

### 2.1 日常情绪与记录（轻）
- 心情日记 / 心情轮：颜色、情绪、标签（场景/人物/地点），周月情绪曲线；可选语音转写、图片贴纸；支持与 REBT A-B-C 记录关联。
- 每日日签 & 微反思：30 秒写一句，自动汇编“我的一周情绪摘要”。

### 2.2 行动闭环与学习支持（轻~中）
- 微习惯任务卡：低门槛任务（整理桌面 10 分钟、深呼吸 3 轮等），轻提醒 → 回执 → T+1 回访 → 依从性看板，确保建议被完成。
- 番茄钟 + 学业小目标：10 分钟冲刺、错题本 1 页等，和压力缓解建议库联动，形成学业闭环。

### 2.3 自助心理工具（无~中）
- REBT 思维记录（中）：A-B-C-D-E 结构化引导，自动生成理性替代语句，可保存“反驳模板”。
- 呼吸/放松/正念练习（无~轻）：2~5 分钟音频与动效；练习后情绪打分纳入周报。
- 睡眠与作息助手（轻）：睡前收尾清单、白噪声、次日待办接力；“晚安模式”统一灰度与提醒节流。

### 2.4 专题板块（中）
- 学业与考试压力：考试倒计时、复习计划小组件、复盘模板，与“信念重构 + 行为实验”结合。
- 社交关系：非暴力沟通开场句、共情练习、室友边界卡、快捷“先发一句”。
- 恋爱情绪：关系温度计、注意力分离 5 分钟、小约定生成器。
- 睡眠与作息：习惯养成任务、睡眠日记、晚安模式联动。

### 2.5 社区与安全（中~重）
- 树洞（匿名）与同伴空间：发帖/评论脱敏入库、主题标注、风险信号；超阈值仅授权角色可见并触发温和关怀。
- SOS / 危机干预快捷入口（重）：长按 2 秒呼出安全页，稳定化脚本 → 热线/校内转介 → 最小必要信息共享与审计。

### 2.6 成长激励（轻）
- 护心徽章 & 微胜利回顾：以完成率、连续天数、复访改善度驱动温和成就感，避免打卡焦虑。
- 每周“护心周报”（中）：主要情绪、任务完成度、下周 Top3 微建议与“避坑提醒”。

### 2.7 资源与评测（轻~重）
- 校内资源地图/预约导航（轻）：心理中心、辅导员、社团与公益热线一键触达，默认匿名/化名。
- AI×专家 PK 评测区（重，内部）：标准化问卷或脱敏案例双评分，监控一致性与模型漂移，形成改进闭环。

### 2.8 实验性增补（可选）
- 多模态情感开关（可选）：语音语调、面部表情（本地推理）等按需开启，默认关闭。
- 考试季/节日主题皮肤（无）：视觉与动效的季节性变体，营造被理解的氛围。

## 3. 信息架构（IA）蓝图
```
底部导航：〔今天〕〔日记〕〔树洞〕〔我的〕
悬浮按钮：短按「快速记一笔」｜长按 2s 「SOS」
今天：情绪打卡｜今日 Top3 微建议｜任务卡列表｜专题入口｜护心周报 Banner
日记：心情轮/标签｜文本/语音/图片｜周月图｜REBT 记录；清单视图列出全部任务卡与番茄冲刺
树洞：发帖→草稿自检→匿名/化名发布；话题流；情绪温度条（本人可见）与礼貌守则
我的：护心周报｜徽章｜隐私与授权中心｜资源导航｜设置
```
- 动线 1（主筋）：建议 → 任务 → 提醒 → 回执 → T+1 复盘 → 周报 → 下一步建议。
- 动线 2（社区）：帖子 → 草稿自检 → 发布 → 风险检测 → 温和关怀/人工转介。

## 4. 版本节奏
- **P0 / 稳定骨架**：心情日记、微习惯任务闭环、护心周报基础版；树洞灰度开放（草稿自检 + 脱敏入库）。
- **P1 / 自助专题**：REBT 记录、呼吸正念、学业/睡眠专题板、成长徽章；树洞风险检测上线，打通授权告警与人工转交；建立依从性与社区活跃看板。
- **P2 / 社区与安全增强**：树洞全面上线并引入行动卡共学；AI×专家 PK 模块；多模态情感开关（可选）；完善审计、异常复盘与安全演练。

## 5. Dify 落地映射
- 工作流
  - `行为闭环-任务创建与跟踪`：建议/行动卡 → 写入 `behavior_tasks` → 安排提醒 → 监听回执 → 记录 `task_events`/`checkins` → T+1 回访对话。
  - `树洞-ingest-预警`：新帖/新评 → 脱敏清洗 → 向量化/主题标注 → 风险打分 → 阈值告警/人工转交 → 审计记录。
  - `weekly-report`：每周 Cron 聚合情绪、任务、风险数据 → 生成周报推送。
  - `危机干预与人工转交`：高危触发稳定化脚本 → 生成摘要 → 最小必要信息路由 → 审计留痕。
- Agent
  - 情绪侦测、用户画像、学业/社交/恋爱情绪/睡眠专题、危机干预。
  - 知识库：REBT、微习惯库、树洞礼貌守则、危机脚本。

## 6. 数据与埋点扩展
- `journals`：`journal_id, user_id, mood_score, mood_tags[], text, media_refs[], abcd_ref?, created_at`。
- `behavior_tasks` / `task_events` / `checkins`：补充 `source`, `remind_window`, `completion_note` 等字段。
- `daily_reports` / `weekly_summaries`：情绪分布、任务完成、Top3 下一步、风险摘要（仅本人或授权角色可见）。
- `forum_posts` / `forum_embeddings` / `risk_signals` / `evaluation_rounds`：服务树洞与 PK 模块。
- 核心指标：建议接受率、任务启动/完成率、宽限转化、T+1 复盘完成率；树洞日活发帖/评论/行动卡领取与草稿自检通过率；高危响应时延与准确率；AI 对话评分、周报打开率。

## 7. 隐私与安全基线
- 默认匿名/化名，最小必要信息共享；显性授权可随时撤销。
- RBAC/ABAC 控制字段可见性；所有查看、转交、导出均写入审计日志。
- 紧急例外：自/他伤高危且失联时触发应急流程，同时记录异常事件供复盘。
- 树洞非公开数据脱敏后存储，定期滚动审计与安全演练。

## 8. 下一步
1. 基于本方案输出“今天/日记/树洞/SOS”低保真交互稿。
2. 与后端/工作流工程师对齐 `行为闭环` 与 `树洞-ingest-预警` 的字段及触发事件。
3. 建立 P0 阶段的埋点与看板配置，确保上线后可量化验证。
