# 任务: MindGuard 社区导向整体开发方案

## 📍 CoT: 问题定义
- 核心问题：构建以社区为主线、AI 为支撑的大学生心理健康服务系统，实现“对话→行动→社区→预警→人工协同”的闭环。
- 成功标准：
  1. 社区（树洞/同伴空间）成为主入口，AI 对话产出的建议可转化为社区内可执行行动并被追踪。
  2. 行为闭环（任务卡/提醒/回执/T+1 回访）与情绪日记、社区互动数据打通，形成周报与风险看板。
  3. 预警与人工转交具备最小必要信息共享、RBAC/审计与紧急例外流程。
  4. 提供阶段化实施路线（P0~P2 / v0~v3）与关键指标体系，便于落地与迭代。
- 约束与边界：沿用现有 Dify 工作流与 Agent 体系；遵守项目既定设计语言（今天/日记/树洞/我的 与双态悬浮按钮）；强调隐私合规（匿名、最小必要信息、审计）。
- 工具增强上下文：整合《终极整合 MAX 方案》《补充方案-行为闭环与论坛》《MindGuard 整合版》《功能扩展》《tab 页设计蓝图》中的架构、功能、数据与工作流设定。
- 假设：
  1. 已具备主对话工作流与基础情绪识别能力。
  2. 前端（小程序/Web）可以支持多 Tab、悬浮按钮与动态模块。
  3. 数据库与日志系统可扩展以容纳新增表结构。
- 验收标准：形成一份在 docs/开发方案 下的完整方案文档，覆盖体验、技术、数据、安全、里程碑与指标，并明确社区优先的策略。

## 🔄 AoT: 算法分解
- 分解树：
  1. 体验架构 → 导航/动线/用户旅程 → 社区与行动闭环对齐。
  2. 功能模块 → 社区/行动闭环/自助工具/AI 对话 → 互联触点。
  3. 技术实现 → Dify 工作流/Agent/接口 → 前后端与数据。
  4. 安全合规 → 授权/审计/紧急 → 标准化机制。
  5. 版本路线 → P0~P2 & v0~v3 → 里程碑与依赖。
  6. 指标体系 → 行为依从性/社区活跃/风险响应/满意度。
- 执行序列：先固化体验与社区主线 → 定义模块能力与交互 → 整合技术与数据架构 → 梳理安全 → 给出路线与指标。
- 启发式决策：以最低必要复杂度交付可用闭环（KISS/YAGNI），优先把建议转化为行动与社区互动（Why-How-Done），用现有数据表为单一事实来源（DRY）。

---

## 1. 愿景与定位
- **产品角色**：MindGuard 心理管家——以同伴社区为主场，AI 作为 7x24 哨兵与行动教练，联动校内资源构建连续守护。
- **价值主张**：
  - 社区共建：树洞/行动卡让学生在安全环境中表达、互助、共学。
  - 行为闭环：AI 建议必须落地为可完成的小行动，闭环记录与复盘。
  - 预警协同：风险信号来自对话与社区双通道，授权后迅速联动人工。
- **设计原则（Why-How-Done）**：
  - Why：降低孤立感、缩短求助路径、把“知道”变成“做到”。
  - How：设计为主，AI 适度介入；微习惯驱动的渐进式改善；跨触点数据联动。
  - Done：行为与情绪均可度量；预警准确可追踪；隐私合规可审计。

## 2. 用户场景与旅程
- **日常情绪调节**：学生通过“今天”页快速打卡情绪→收到 Top3 微建议→领取任务→次日复盘→周报反馈成效。
- **同伴支持与社区互动**：学生在树洞分享困扰→草稿自检减少冲突→其他学生领取行动卡或给予轻反馈→风险信号在后台监控。
- **风险上升与转介**：系统捕捉到连续负向情绪或树洞高危表达→触发危机干预工作流→用户显性授权→推送给辅导员/心理中心 →审计留痕→回访闭环。

## 3. 体验与信息架构
- **底部导航**：`今天｜日记｜树洞｜我的`；右下悬浮按钮短按“快速记一笔”、长按 2s 呼出 SOS。
- **全局节奏**：默认低扰动，夜间触发“晚安模式”，考试周可启用主题皮肤。
- **关键页面**：
  - `今天`：情绪打卡 → Top3 微建议（任务卡一键生成）→ 今日任务进度 → 专题快捷入口 → 护心周报 Banner。
  - `日记`：二级切换 `日记｜清单`；日记支持文本/语音/图片、REBT 模板；清单展示微习惯任务卡与番茄冲刺。
  - `树洞`：发帖草稿自检、匿名/化名开关、情绪温度条（仅本人可见）、轻量反馈、风险守护提示。
  - `我的`：护心周报、徽章体系、隐私与授权中心、资源地图（校内外热线/预约）。
- **动线闭环**：`建议 → 任务 → 提醒 → 回执 → T+1 复盘 → 周报`；`社区帖子 → 草稿自检 → 发布 → 风险检测 → 温和介入/转介`。

## 4. 核心模块设计
### 4.1 社区主场（树洞与行动卡）
- 匿名发帖、礼貌守则、自检提示；轻量反馈（抱抱/打 Call）。
- 行动卡可由官方或用户分享，其他学生点击领取即写入 `behavior_tasks` 并纳入追踪。
- 风险检测：脱敏→向量化→主题/情绪/风险判定；高危进入辅导队列。
- 运营策略：专题看板、共学行动挑战、周度树洞精选（确保正向引导）。

### 4.2 行为闭环与微习惯
- 微习惯库结构：`{场景, 目标情绪, 步骤, 预计时长, 预计收益, 备选}`。
- 任务卡字段：标题、步骤、预计耗时、截止、来源（AI/社区/自建）、备选方案。
- 提醒策略：到期前 15m / 到期 / 宽限 +30m；夜间静音。
- 回执渠道：按钮（开始/完成/跳过）、文本、语音、照片。
- 复盘：T+1 询问情绪与执行感受，写入 `checkins` 与 `task_events`。

### 4.3 自助工具箱
- REBT 结构化记录：A-B-C-D-E 表单、一键生成理性替代语句、保存为“反驳模板”。
- 呼吸/正念/放松练习：2-5 分钟音频与动效，引导后记录情绪分。
- 学业/社交/恋爱情绪/睡眠专题：提供模板化行动、对话脚本、复盘提示。
- 周报生成：聚合情绪、任务、风险、推荐下一步三件事。

### 4.4 AI 对话与守护
- 角色：情绪侦测 Agent、用户画像 Agent、各专题 Agent、危机干预 Agent。
- 职责：
  - AI 对话提供即时共情与 REBT 辅导，产出可执行微建议。
  - 将建议推送到任务闭环，或在社区生成行动卡草稿。
  - 风险信号超过阈值时联动危机干预工作流并请求用户授权。
- 约束：AI 输出优先简洁可执行；避免空泛“正确废话”；所有建议有来源可追溯。

## 5. 技术架构与 Dify 工作流
- **前端**：小程序/Web（Taro/微信原生/应选框架）提供多 Tab 与组件化模块。
- **后端**：
  - Dify 工作流：
    - `行为闭环-任务创建与跟踪`：建议/行动卡 → 写入任务 → 安排提醒 → 监听回执 → 记录事件 → 回访。
    - `树洞-ingest-预警`：帖子事件 → 脱敏 → 向量化 → 情绪/风险打分 → 阈值告警 → 人工转介。
    - `weekly-report`：每周 Cron 聚合任务与情绪数据 → 生成周报推送。
    - `危机干预与人工转交`：高危触发稳定化脚本 → 生成摘要 → 最小必要信息告警 → 审计记录。
  - Agent 集群：情绪侦测、画像、学业、社交、恋爱、睡眠、危机干预。
  - 知识库：REBT、微习惯库、树洞运营规范、危机脚本。
- **集成**：
  - 数据库（Mongo/Postgres/云原生）支持表结构扩展。
  - 消息推送（小程序订阅消息/SMS/邮件）用于提醒与告警。
  - 审计日志与权限控制（RBAC/ABAC）。

## 6. 数据架构与单一事实来源
- 行为闭环：`behavior_tasks`、`task_events`、`checkins`、`daily_reports`、`weekly_summaries`。
- 社区：`forum_posts`、`forum_embeddings`、`risk_signals`。
- 评测：`evaluation_rounds`（AI×专家 PK）。
- 日记：`journals`（含情绪标签、媒介、关联任务）。
- 授权与审计：`consents`（对象、范围、有效期）、`audit_logs`（操作者、动作、时间、上下文）。
- 数据流水线：行为与社区数据写入后触发消费（周报、风险看板、运营洞察）。

## 7. 安全、隐私与合规
- **最小必要信息**：默认匿名/化名；风险告警仅携带情绪等级、风险类型、时间窗、建议行动摘要。
- **显性授权**：所有信息外发需用户确认；记录来源、范围、有效期；支持随时撤销。
- **角色控制**：RBAC/ABAC 精细化字段权限，辅导员与心理中心仅查看获授字段。
- **审计留痕**：所有查看/转交/导出操作写入审计日志；高危事件额外标记复盘责任人。
- **紧急例外**：自/他伤高危且用户失联时触发应急流程，同时写入异常记录供复盘。
- **数据保留策略**：树洞原始文本脱敏后存储；对话与行动数据按政策定期回溯清理。

## 8. 版本路线与里程碑
- **P0 / v0（4-6 周）**：
  - 交付“今天/日记/我的”骨架；心情打卡、Top3 微建议、任务卡闭环（提醒+回执+T+1 回访）、护心周报基础版。
  - 树洞先以白名单灰度开放，完成发帖草稿自检与脱敏入库。
- **P1 / v1（+4 周）**：
  - 完成 REBT 记录、呼吸与正念工具、学业/睡眠专题板。
  - 树洞风险检测上线，温和关怀与人工转交通路打通。
  - 建立依从性与社区活跃看板；完善授权中心。
- **P2 / v2（+6 周）**：
  - 树洞全面上线并引入行动卡共学机制；AI×专家 PK 评测模块投入。
  - 多模态情感开关（可选 A/B）；周报升级为个性化策略推荐。
  - 完成全量审计、异常复盘机制与安全演练。
- **P3 / v3（可选迭代）**：
  - 深入运营：主题活动、多校共建、更多专题 Agent。
  - 模型调优：基于 PK 数据与用户反馈迭代知识库与提示词。

## 9. 指标体系与看板
- **行为依从性**：建议接受率、任务启动率、完成率、宽限转化、T+1 复盘完成率、连续完成天数。
- **社区活跃度**：日活发帖/评论/领取行动卡、草稿自检通过率、树洞正向反馈比、违规/撤回率。
- **风险治理**：高危信号响应时延、升级准确率、误报与漏报率、转介完成率、危机复盘闭环率。
- **体验满意度**：AI 对话评分、树洞体验反馈、NPS/CSAT、SOS 使用后的满意回访。
- **模型质量**：AI×专家评分差异、PK 胜率、漂移预警次数。
- **运营与增长**（可选）：新用户 7 日留存、周报打开率、专题活动参与率。
- 看板建议：产品（行为漏斗）、社区（活跃/风险）、安全（授权/审计）、运营（增长/满意度）。

## 10. 资源依赖与协作
- **人力**：
  - 产品/体验：1 名总负责人 + 交互/视觉（支持社区与行动卡）。
  - 技术：前端 2（小程序/Web）、后端 1（API/数据服务）、工作流工程师 1（Dify）。
  - 运营与心理专家：树洞审核、危机干预、微习惯库建设。
- **数据与内容**：REBT 与微习惯素材、校内资源清单、危机脚本、树洞礼貌守则。
- **工具**：Dify、向量数据库（OpenSearch/PG-Vector）、埋点与看板（Mixpanel/自建 BI）。

## 11. 风险与缓解
- **社区舆情风险**：制定审核 SLA、引入关键词/模型预过滤、运营值班。
- **依从性不足**：保持任务轻量；提供多样备选方案；用周报与徽章强化正反馈。
- **隐私担忧**: 透明化授权界面、默认匿名、定期发布安全报告。
- **技术负载**：树洞高峰采用队列缓冲与分级告警；任务提醒限流避免骚扰。
- **模型偏差**：持续 PK 评测与用户反馈闭环，必要时回退到人工脚本。

## 12. 与现有文档的衔接
- 体验层参考：`docs/开发方案/功能扩展.md`、`docs/开发方案/tab页设计蓝图.md`。
- 技术与运营策略：`dify/方案/大学生心理健康智能助手系统：终极整合MAX方案.md`、`dify/方案/大学生心理健康智能助手系统：补充方案-行为闭环与论坛.md`、`dify/方案/MindGuard-总体方案-整合版.md`。
- 数据库结构：`doc/开发文件/database/*.md`（若未建需同步创建）。

---

**下一步建议**
1. 基于本方案输出低保真交互稿（重点：今天/日记/树洞/SOS）。
2. 启动“行为闭环-任务创建与跟踪”与“树洞-ingest-预警”两条工作流原型配置。
3. 建立 P0 阶段的埋点与指标看板，确保上线后可量化验证。
