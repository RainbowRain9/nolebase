# 页面：发布帖子（路径：miniprogram/packages/community/post-editor/index）

## 1. 页面目标与角色
- 提供草稿编辑、自检与匿名/化名发布能力；面向社区发帖用户；主流程：树洞。

## 2. 入口与去向（导航）
- 入口来源：pages/treehole/index 发帖入口；post-detail 编辑本人帖子 `?postId=xxx&mode=edit`。
- 去向页面：
  - packages/community/post-detail：发布成功后跳转 `?postId=xxx`
  - packages/community/topic：选择或新建话题 `?topic=xxx`
- 路由示例：`wx.navigateTo({ url: '/packages/community/post-editor/index?mode=create' })`
- 分包关系：packages/community；被 pages/treehole/index 预加载（wifi）。

## 3. 关键组件与交互
- 组件清单：文本输入、话题标签选择器、匿名/化名切换、草稿保存提示、风险提示条、发布按钮。
- 交互描述：
  - 自动草稿：定时保存，退出时提示恢复。
  - 草稿自检：发布前本地自检 + 服务器复核（拦截或警告）。
  - 附件：图片压缩与上传状态；失败可重传。
- 无障碍与文案：发布失败提示避免指责，建议“调整表述或查看帮助”。

## 4. 数据契约与接口
- 入参：`postId?`, `mode:create|edit`
- 出参：`post_id`
- 集合：docs/数据库/集合-树洞帖子.posts.md、docs/数据库/集合-用户事件.events.md
- 接口与字段：docs/接口占位文档.md（含内容审核/上传）
- Mock 切换：同上；图片走临时存储占位。

## 5. 埋点与观测
- `pv_treehole_post_editor`（onShow）
- `clk_toggle_anonymity`、`clk_add_topic`、`clk_attach_image`
- `treehole_post_publish`（提交后）参数：`topic`, `risk_score`, `anonymity_mode`
- `exp_post_editor_first_paint`

## 6. 异常与边界
- 文本过长/违规：提示并定位问题字段。
- 弱网：附件排队上传，支持离线草稿本地存储。
- 失败重试：保存至草稿并提示稍后发布。

## 7. 验收清单（DoD）
- [ ] 支持创建/编辑/自动草稿/恢复
- [ ] 自检/复核拦截与提示链路完备
- [ ] 图片压缩、上传、失败重试
- [ ] 埋点与首屏完成上报
- [ ] 无障碍与文案合规
- 测试用例：树洞-发帖流程

## 8. 关联文档
- 功能：docs/功能文档/功能-树洞发帖与草稿自检.md
- 风险：docs/功能文档/功能-树洞风险提示与温和守护.md

## 9. 变更记录
- 2025-09-22 by Codex：首次创建

