# 页面：今天 TAB

## 页面定位
今天Tab是MindGuard小程序的主入口，聚焦"今日状态洞察 + 核心工具入口 + 任务提醒 + 社区动线 + 资源推送"，让用户快速判断"现在该做什么"。作为情绪-建议-任务闭环的核心启动页面，提供状态概览、AI智能推荐和关键工具访问，是用户每日使用频率最高的页面。

## 核心模块与入口

### 模块1：今日状态卡
- **功能描述**：展示用户当日情绪状态、压力指数和风险等级，支持同日多次打卡，记录情绪评分、标签、场景与备注；自动绘制当日心情曲线，并为AI情感计算、微建议和周报提供基础数据。负向情绪会触发ASK助理、任务推荐及预警策略。参考《功能-情绪打卡.md》
- **涉及组件**：情绪状态卡组件、心情曲线抽屉、风险提示徽标、补充随笔按钮
- **交互说明**：
  - 用户点击状态卡或"再次打卡"按钮，弹出情绪打卡面板
  - 面板提供情绪评分（五档表情刻度）、情绪标签（支持自定义/多选）、场景标签（学业/社交/自我等）及自由备注
  - 点击"保存"后，系统记录打卡时间、评分与标签，刷新当日曲线节点
  - AI即刻判定情绪类型（正向/中性/负向）及风险等级（L1-L3），在状态卡上更新彩色徽标和提示文案
  - 若情绪为负向或风险≥L2，自动展开ASK助理浮层并推送2-3条微建议
  - 打卡成功后可选择"补充随笔"，跳转到心情随笔录入面板并携带当前数据

### 模块2：Top3 微建议列表
- **功能描述**：基于情绪打卡、心情随笔、树洞互动与历史任务执行数据，AI动态生成微建议与行动任务模板。系统按情绪正负向与风险等级调整建议强度，并支持一键写入任务清单或推送给真人协同角色。参考《功能-微建议与任务生成.md》
- **涉及组件**：微建议卡片组件、AI推荐标识、一键生成任务按钮
- **交互说明**：
  - 数据输入：AI每次在检测到新的情绪打卡、随笔、树洞帖子或任务复盘后触发计算，生成候选微建议
  - 建议分层：系统将建议分为"即时缓解"、"持续改善"、"社交连接"、"专业求助"四类，并按照情绪正/负向和风险等级做排序
  - 呈现策略：正向情绪展示1-2条保持状态的轻量建议；负向情绪L1-L2展示3条以内的可执行建议；负向情绪L3优先推荐专业求助与真人协同选项
  - 生成任务：用户点击建议卡的"一键加入清单"，系统弹出确认弹窗，可选择任务来源（AI/自建/真人）、预计完成时间和提醒方式
  - 真人指派：当建议涉及心理咨询师或辅导员时，系统将生成待确认任务，发送至对应角色审核

### 模块3：工具箱
- **功能描述**：提供2行×4列的网格布局工具入口，包含心情随笔、清单、呼吸、正念、树洞、任务、打卡、SOS等核心功能模块，是各个Tab页面的快速访问入口。
- **涉及组件**：工具网格卡片组件、功能图标、首字图形标识
- **交互说明**：
  - 每个工具卡包含48×48px图标块与下方32px文本区
  - 点击工具卡直接跳转到对应功能页面或打开对应功能面板
  - SOS卡片采用红色主图标，具有特殊的紧急响应机制

### 模块4：进行中的任务预览
- **功能描述**：展示用户当前进行中的任务，包含任务标题、描述、状态徽章和CTA按钮，支持直接进入任务执行流程，是任务闭环的前置入口。
- **涉及组件**：任务进度卡片组件、状态徽章、CBT标识、CTA按钮
- **交互说明**：
  - 展示"整理书桌10分钟"等任务示例，包含任务标题、描述和状态信息
  - 右上角显示"Success"状态徽章，左下角显示任务来源标识（如"CBT练习"、"AI建议"）
  - CTA按钮支持"开始任务"、"继续执行"等操作，点击后进入任务详情或番茄计时器
  - 任务状态变更后同步更新卡片显示和统计数据

### 模块5：个性化资源推送
- **功能描述**：基于用户情绪状态和画像标签，推荐相关的心理支持资源，包括音频、视频、文章等，帮助用户获得更专业的心理支持。
- **涉及组件**：资源推送卡片组件、水平滚动容器、资源缩略图
- **交互说明**：
  - 水平滚动展示推荐资源卡片，每个卡片包含资源缩略图、类型图标、标题和时长信息
  - 显示推送原因，如"基于你的焦虑情绪推荐"
  - 点击资源卡片可进入资源详情页面，支持收藏、分享、评价等交互

### 模块6：社区动态卡
- **功能描述**：展示树洞社区的精选动态，包含帖子标题、互动信息和风险等级标签，引导用户参与社区互动，同时提供风险提示和资源引导。
- **涉及组件**：社区高亮卡片组件、互动统计信息、风险等级标签
- **交互说明**：
  - 展示社区热点帖子，如"有人在分享：考前焦虑自救清单"
  - 显示互动信息，如"12条评论·3人收藏"
  - 风险标签显示帖子风险等级（R1-R4），不同等级使用不同颜色标识
  - 整卡可点击进入树洞详情页，支持社区互动和风险资源访问

## AI / 协同逻辑

### AI情绪分析与判定
- **情绪判定机制**：每次情绪打卡后，AI立即分析情绪评分、标签和内容，判定情绪类型（正向/中性/负向）和风险等级（L1-L4）
- **风险响应策略**：L1级显示观察提示，L2级触发ASK助理和资源推荐，L3级强烈建议专业求助，L4级自动触发SOS流程
- **个性化推荐**：基于用户画像、历史数据和当前状态，AI生成个性化的微建议和资源推荐

### ASK心理助理协同
- **自动触发机制**：当检测到负向情绪或风险≥L2时，自动展开ASK助理浮层
- **CBT/REBT支持**：提供认知行为疗法支持，引导用户识别非理性信念、检验证据、生成替代性思考
- **真人协同流程**：当需要专业介入时，ASK助理作为桥梁，协助用户联系心理咨询师或辅导员

### 任务生成与协同
- **智能任务生成**：基于情绪分析结果，自动生成相关的心理调节任务和练习
- **真人指派机制**：涉及专业心理支持的任务，会发送至对应的咨询师或辅导员审核
- **执行反馈闭环**：任务执行结果反馈至AI系统，用于优化后续的推荐和判定算法

## 涉及组件

### 核心业务组件
- **StatusSummary**：今日状态卡组件，展示情绪状态、压力指数和风险等级
- **MicroSuggestions**：微建议列表组件，展示AI推荐的个性化建议
- **ToolHub**：工具箱网格组件，提供各功能模块的快速入口
- **TaskProgressCard**：任务进度卡片组件，展示进行中任务的预览
- **ResourcePush**：资源推送组件，展示个性化推荐资源
- **CommunityHighlight**：社区高亮卡片组件，展示社区精选动态

### 交互组件
- **情绪打卡弹窗**：包含表情刻度控件、标签多选器、备注输入框
- **ASK助理浮层**：包含对话界面、CBT工具选项、真人协同入口
- **任务确认弹窗**：用于微建议转任务的确认和配置
- **资源详情弹窗**：显示资源详细信息和操作选项

### 状态组件
- **风险提示徽标**：根据风险等级切换颜色和文案（R1观察/R2关注/R3警示/R4危急）
- **CBT标识**：显示认知行为疗法相关标识和提示
- **状态徽章**：显示任务状态、徽章解锁状态等

## 页面跳转关系

### 从今天页跳出的链接
- **情绪打卡详情**：点击状态卡查看当日所有打卡记录和心情曲线
- **心情随笔录入**：打卡后点击"补充随笔"按钮跳转，或通过工具箱进入
- **任务详情/执行**：点击任务预览卡或微建议的"生成任务"按钮进入
- **树洞社区**：点击社区动态卡进入树洞Tab或具体帖子
- **资源详情**：点击推荐资源进入资源详情页面
- **Ask助理对话**：负向情绪时自动展开或手动点击进入
- **SOS紧急求助**：通过工具箱SOS卡片或长按SOS按钮触发

### 跳转到今天页的入口
- **小程序首页**：用户打开小程序默认进入今天Tab
- **其他Tab返回**：从其他Tab点击底部导航返回今天页
- **任务完成返回**：任务执行完成后可选择返回今天页
- **资源使用返回**：使用完推荐资源后返回今天页

## 数据需求与埋点

### 数据来源
- **情绪打卡数据**：`checkins`表，包含user_id、mood_score、mood_category、mood_tags、scene_tags、notes、risk_level、created_at
- **微建议数据**：`recommendations`表，包含rec_id、user_id、category、mood_reference_id、risk_level、confidence、created_at
- **任务数据**：`behavior_tasks`表，包含task_id、user_id、source、emotion_category、title、description、estimated_minutes、planned_at、due_at、created_at
- **用户画像数据**：`user_profiles`表，包含emotion_baseline、risk_tier、preference_tags、adherence_score等
- **社区数据**：`forum_posts`表，用于社区动态卡的内容展示

### 关键API
- **`/api/moods/today`**：获取当天情绪打卡数据及心情轮统计
- **`/api/micro-tips`**：根据情绪画像返回Top3微建议列表
- **`/api/tasks`**：从微建议生成任务写入清单
- **`/api/tasks/summary`**：查询来源/情绪类别统计、延迟原因Top5
- **`/api/resources`**：返回个性化推荐资源数据
- **`/api/forum/highlight`**：获取社区精选动态

### 埋点事件
- **打卡行为埋点**：记录情绪打卡的触发、完成、结果等行为
- **建议交互埋点**：记录微建议的展示、点击、转化率等数据
- **任务转化埋点**：记录从建议到任务的转化路径和效果
- **资源使用埋点**：记录推荐资源的点击、使用效果等数据
- **社区互动埋点**：记录社区动态的点击、参与度等数据
- **页面停留埋点**：记录今天页的访问时长、浏览深度等数据

