# 页面：心情随笔 Tab

## 页面定位
心情随笔Tab是个人情绪与认知的"档案室"，承载"记录×复盘×洞察"三大核心功能。作为多模态情绪记录的专门页面，与情绪打卡形成互补，为任务系统提供情感背景，同时通过REBT认知重构模板帮助用户建立健康的思维模式，是情绪闭环的重要数据源和认知成长的核心场所。

## 核心模块与入口

### 模块1：多模录入入口
- **功能描述**：支持文本、语音、图片（含手写拍照OCR）等多种输入方式，结合REBT认知重构模板记录情绪体验，与情绪打卡系统共享数据。参考《功能-心情随笔与多模录入.md》
- **涉及组件**：多模录入面板、文本域、语音录制按钮、图片上传、情绪评分滑条、标签选择器
- **交互说明**：
  - 点击"新增随笔"或从今天页跳转，打开多模态录入面板
  - 多模输入支持：文本（支持Markdown基础格式、字数统计）、语音（实时转写为文本，可手动编辑）、图片（上传手写/书写照片，OCR提取文字）、附件（支持上传图片/音频）
  - 情绪标注：保存前需选择情绪评分（与情绪打卡共用刻度）、情绪标签、场景标签；若当天未打卡，可勾选"同步生成情绪打卡"
  - REBT模板：可选展开A-E表单（Activating event、Belief、Consequence、Dispute、Effect），系统提供引导问题帮助完成认知重构

### 模块2：随笔视图
- **功能描述**：展示用户的心情随笔列表，支持查看、编辑、删除和生成任务等操作，每条随笔包含情绪标签、关键词和AI生成的摘要信息。
- **涉及组件**：随笔卡片组件、情绪标签组件、关键词显示、AI摘要卡、生成任务按钮
- **交互说明**：
  - 随笔卡片包含：头像+时间+情绪标签、正文三行截断、附件标签（语音/Lavender、图片/Mint、任务关联/Brand）
  - 底部操作：生成任务（Success色系次按钮，点击跳转任务Tab）、收藏、更多操作
  - 点击展开显示全文与REBT字段，长按可呼出操作菜单
  - 支持按时间、情绪标签、关键词筛选和搜索

### 模块3：趋势视图
- **功能描述**：提供情绪趋势的视觉化展示，包含折线图、标签云和场景分类统计，帮助用户了解情绪变化规律和模式。
- **涉及组件**：情绪折线图组件、标签云可视化组件、场景分类条组件、时间切换控件
- **交互说明**：
  - 折线图：主线品牌蓝，阈值线Info-200，数据点根据情绪分类着色
  - 支持周/月切换，切换动画200ms内完成
  - 标签云：Chip背景--color-info-50，文本Info-600，支持多选过滤
  - 场景分类条：横向滑动条展示社交/学业/自我/健康等比例，点击筛选随笔列表

### 模块4：AI推荐与干预
- **功能描述**：基于随笔内容进行智能分析和风险监测，提供个性化建议和适时的干预措施，确保用户在记录过程中获得必要的支持。
- **涉及组件**：AI推荐条组件、风险提示组件、资源推荐入口
- **交互说明**：
  - AI摘要生成：保存后生成情绪摘要、关键词与推荐任务，展示在随笔卡顶部
  - 连续负向提示：若连续两条随笔判定为负向，自动弹出ASK助理与资源提示
  - 风险监测：基于内容分析识别潜在风险，提供相应的资源和建议
  - 个性化推荐：根据情绪状态和内容特征推荐相关的心理资源和支持工具

### 模块5：任务派生系统
- **功能描述**：将随笔内容转化为具体的行动任务，支持AI智能生成、真人指派和用户自建等多种任务创建方式，形成从记录到行动的完整闭环。
- **涉及组件**：任务生成弹窗、任务来源选择器、时间设置组件、提醒配置组件
- **交互说明**：
  - 在随笔卡点击"生成任务"，选择来源（AI建议/自建/真人）与计划时间
  - AI建议任务：基于随笔内容自动生成个性化建议
  - 真人指派任务：辅导员或心理咨询师根据随笔内容指派关怀任务
  - 自建模板任务：用户从预设模板中选择或自定义任务
  - 创建后自动跳转至任务Tab查看详情，任务中会引用该随笔作为背景

### 模块6：搜索与筛选系统
- **功能描述**：提供强大的搜索和筛选功能，帮助用户快速找到特定的随笔记录，支持关键词搜索、标签过滤、时间范围筛选等多种查找方式。
- **涉及组件**：搜索栏组件、标签过滤器、时间选择器、高级筛选选项
- **交互说明**：
  - 关键词联想搜索（室友、考试、压力等）
  - 标签过滤器，按情绪类型、场景、时间筛选
  - 智能推荐相关随笔，建立内容关联
  - 搜索结果可导出或分享给ASK/真人协同

## AI / 协同逻辑

### 多模态内容理解
- **智能解析**：语音转写与图片OCR在保存前输出文本草稿，供AI统一情绪判定与关键词提取，支持混合模态的内容理解
- **情绪映射**：随笔保存即绑定当日情绪标签，若检测到连续负向情绪，会弹出ASK助理与资源建议
- **REBT分析**：AI自动分析用户记录中的A（事件）、B（信念）、C（结果），帮助识别非理性信念，并提供D（辩驳）和E（新效应）的引导

### 个性化推荐系统
- **内容分析**：基于随笔内容的深度分析，识别情绪主题、触发因素和应对模式
- **任务生成**：根据内容特征自动生成相关的心理调节任务和练习
- **资源推荐**：推荐针对性的心理资源、社区话题和专业支持
- **学习建议**：基于用户的记录模式，推荐REBT学习材料和技能练习

### 风险监测与干预
- **异常监测**：识别记录频率异常、内容模式异常、情绪波动异常等情况
- **风险评估**：基于内容分析评估风险等级，触发相应的预警机制
- **及时干预**：提供适时的资源推荐、专业支持建议和紧急求助入口
- **协同机制**：与学校协同系统联动，确保高风险情况得到及时处理

## 涉及组件

### 核心业务组件
- **JournalView**：随笔视图主组件，管理列表展示和筛选逻辑
- **TrendView**：趋势视图组件，提供情绪趋势的视觉化展示
- **JournalCard**：随笔卡片组件，展示单条随笔的完整信息
- **MultimodalInputPanel**：多模态录入面板，支持各种输入方式
- **AISummaryCard**：AI摘要卡片，展示智能分析结果
- **TaskGenerator**：任务生成器，处理从随笔到任务的转化

### 交互组件
- **RichTextEditor**：富文本编辑器，支持格式化和表情符号
- **VoiceRecorder**：语音录制组件，支持录音和转写
- **ImageUploader**：图片上传组件，支持OCR识别
- **REBTTemplate**：REBT模板组件，提供结构化的认知重构工具
- **SearchBar**：搜索栏组件，支持关键词搜索和筛选
- **FilterChips**：筛选芯片组件，支持标签过滤

### 状态组件
- **EmotionTags**：情绪标签组件，显示和选择情绪标签
- **KeywordCloud**：关键词云组件，可视化展示关键词
- **RiskIndicator**：风险指示器，显示风险等级和提示
- **ProgressTracker**：进度跟踪器，显示学习和改善进度

## 页面跳转关系

### 从心情随笔页跳出的链接
- **新增随笔** → 打开多模态录入面板；保存后可选择同步至情绪打卡或生成相关任务
- **随笔详情** → 点击随笔卡片查看完整内容，包括REBT分析和AI摘要
- **生成任务** → 打开任务派生弹窗，确认后跳转至任务Tab（带来源筛选）
- **趋势分析** → 查看详细的情绪趋势报告和分析
- **搜索结果** → 基于关键词或标签的筛选结果页面
- **资源推荐** → 跳转到资源详情页面或资源地图
- **ASK助理** → 负向情绪时自动展开或手动点击进入对话
- **REBT学习** → 跳转到REBT学习页面或相关心理教育资源

### 跳转到心情随笔页的入口
- **今天Tab** → 打卡后"补充随笔"按钮跳转，或工具箱"心情随笔"入口
- **任务Tab** → 查看任务相关的随笔背景内容
- **树洞Tab** → 从树洞发帖或互动跳转到相关随笔记录
- **我的Tab** → 从周报或成长统计跳转到历史随笔

## 数据需求与埋点

### 数据来源
- **随笔数据**：`journals`表，包含journal_id、user_id、content、content_type、audio_url、image_urls、ocr_text、mood_score、mood_tags、scene_tags、risk_level、created_at
- **REBT数据**：`journal_rebt`表，包含journal_id、a、b、c、d、e字段
- **摘要数据**：`journal_summary`表，包含AI情绪摘要、关键词、推荐任务ID
- **关联数据**：`journal_links`表，与情绪打卡、任务、树洞的关联关系

### 关键API
- **`/api/journals`**：创建心情随笔、查询列表（含多模REBT结构）
- **`/api/moods/trend`**：查询周/月情绪趋势及标签云数据
- **`/api/tasks`**：从随笔生成任务写入清单
- **`/api/journals/summary`**：获取AI生成的情绪摘要和关键词
- **`/api/journals/search`**：搜索和筛选随笔记录
- **`/api/rebt/analysis`**：获取REBT分析和建议

### 埋点事件
- **记录行为埋点**：记录随笔的创建、编辑、删除等操作
- **多模态使用埋点**：记录不同输入方式的使用频率和效果
- **REBT应用埋点**：记录REBT模板的使用情况和效果
- **任务转化埋点**：记录从随笔到任务的转化路径
- **风险监测埋点**：记录风险识别和干预事件
- **AI分析埋点**：记录AI分析和推荐的使用效果
