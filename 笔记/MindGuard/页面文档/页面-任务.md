# 页面：任务 Tab

## 页面定位
任务Tab是MindGuard小程序的"行动管理中枢"，集中展示所有行动任务，提供来源/情绪筛选、番茄计时、批量操作与统计概览。作为行为闭环的主看板，承载来自AI建议、社区行动卡、心理咨询师/辅导员指派以及用户自建的任务，确保行动建议的有效落地，为用户提供清晰的行动规划和执行追踪。

## 核心模块与入口

### 模块1：筛选区域
- **功能描述**：提供多维度的任务筛选功能，帮助用户快速找到需要的任务，支持来源、情绪类别、状态和时间等多种筛选方式。
- **涉及组件**：来源筛选Chip、情绪标签下拉、搜索框、状态筛选器
- **交互说明**：
  - 背景白色，阴影`0 6px 20px rgba(15,20,26,0.05)`
  - 来源Chip：默认灰100背景、灰600文本；选中填充品牌蓝或来源专属色（AI=Brand、社区=Success、真人=Warning、自建=Ink）
  - 情绪标签下拉：使用下拉列表组件，选中后在Chip区展示可移除标签
  - 搜索框：圆角999，左侧放大镜；支持关键词模糊匹配任务标题、来源说明

### 模块2：任务统计卡
- **功能描述**：提供全局任务状态概览，包含进行中/完成/延期/跳过等统计数据，通过小型柱状图直观展示完成/延期趋势，帮助用户了解整体执行情况。
- **涉及组件**：任务统计卡片组件、进度条、小型柱状图、趋势指标
- **交互说明**：
  - 宽343px、高120px，渐变背景（Brand400→Mint300），圆角20px
  - 内容：左侧大数字（进行中/全部），右侧小柱状图展示完成/延期趋势
  - 底部按钮"查看统计"打开数据抽屉，支持点击查看详细分析

### 模块3：任务列表
- **功能描述**：采用看板式布局，按状态分组管理任务（进行中/即将到期/延期/已完成/已跳过），每个任务卡片显示详细信息并提供快捷操作按钮。
- **涉及组件**：任务卡片组件、来源徽章、状态胶囊、操作按钮组
- **交互说明**：
  - 宽343px，圆角16px，描边1px #E2E8F0，阴影`0 12px 28px rgba(15,20,26,0.05)`
  - Header：来源徽章、情绪类别标签、截止时间；延期任务加红色描边
  - Body：标题16px/700/#2C3640，描述12px/500/#5A6672；可显示随笔或树洞来源链接
  - Footer：番茄/完成/跳过按钮（主要CTA绿色、次要灰描边）；右上角状态胶囊

### 模块4：番茄计时与复盘系统
- **功能描述**：集成专注执行和效果评估功能，支持自定义时长的番茄计时器，任务完成后自动弹出复盘表单，记录执行效果和情绪变化。
- **涉及组件**：番茄计时器弹窗、复盘表单、情绪评分滑块、附件上传组件
- **交互说明**：
  - 番茄计时器：支持自定义时长、休息提醒、专注模式、背景音乐选择
  - 复盘表单：任务完成后弹出，包含情绪前后评分、执行体会、困难记录
  - 效果评估：对比预期与实际效果，分析任务完成质量
  - 真人跟进：可选择是否需要专业人员跟进支持
  - 附件上传：支持添加相关图片、音频等补充材料

### 模块5：批量操作栏
- **功能描述**：提供高效的批量任务管理功能，支持批量延期、设置提醒、导出等操作，提高任务管理效率。
- **涉及组件**：批量操作栏、多选模式组件、批量动作确认弹窗
- **交互说明**：
  - 当至少选中一项出现，背景#FFFFFF，阴影`0 4px 20px rgba(15,20,26,0.16)`
  - 按钮：延期、设置提醒、导出、取消；主按钮采用品牌蓝填充
  - 支持批量选择任务，显示已选中数量，提供一键清除选择功能

### 模块6：数据统计抽屉
- **功能描述**：提供深度数据分析功能，通过上拉抽屉展示完成度分析、延迟分析、真人协同等统计信息，帮助用户了解任务执行模式和效果。
- **涉及组件**：数据抽屉组件、折线图、柱状图、真人协同列表、洞察分析卡片
- **交互说明**：
  - 拖拽出现，顶部圆角24px；包含来源完成度柱状图、情绪类别折线图、真人协同待确认列表
  - 列表项支持跳转：点击来源带筛选参数返回任务列表，点击真人协同进入授权/私聊页
  - 支持时间范围选择，提供钻取式数据分析功能

### 模块7：异常处理与干预
- **功能描述**：监测任务执行情况，识别异常行为模式（如频繁延期、跳过），提供相应的干预和支持措施，确保任务系统的有效性。
- **涉及组件**：异常提示组件、补救建议按钮、求助入口、进度追踪器
- **交互说明**：
  - 频繁未执行监测：连续延期或跳过同类任务≥3次时自动识别
  - 智能提醒机制：在任务页面顶部显示"建议补救"提示
  - 一键求助：提供联系ASK心理助理或真人支持的快捷入口
  - 任务调整建议：基于执行困难提供任务难度和类型调整建议

## AI / 真人协同逻辑

### AI智能任务管理
- **任务生成优化**：基于用户反馈持续优化AI建议任务的质量和适配性
- **动态调整机制**：根据执行情况自动调整任务难度、类型和推荐策略
- **个性化推荐**：基于任务执行历史学习用户偏好和能力水平
- **智能提醒**：根据用户行为模式提供个性化的任务提醒和推送

### 真人协同系统
- **专业指派流程**：心理咨询师/辅导员指派的任务需要提交执行回执
- **跟进机制**：未按时完成触发提醒系统并写入协同队列
- **效果反馈**：专业人员的反馈和建议用于优化后续的指派策略
- **协作优化**：基于协作效果持续改进真人协同的流程和效果

### 社区任务同步
- **行动卡领取**：社区行动卡领取自动标记TREEHOLE来源
- **反馈闭环**：完成后自动回写树洞行动反馈
- **社区互动**：支持从任务跳转回原帖进行社区互动
- **经验分享**：鼓励用户将执行经验分享到社区

### 自建任务管理
- **模板化创建**：支持模板化创建（番茄10min、REBT练习等）
- **个性化定制**：提供灵活的任务定制和调整空间
- **习惯养成**：支持基于自建任务的习惯养成和追踪
- **经验积累**：自建任务的执行经验用于优化AI建议

### 异常处理机制
- **行为监测**：持续监测任务执行行为和模式
- **异常识别**：识别频繁延期、跳过等异常行为
- **及时干预**：提供适时的干预措施和支持
- **效果跟踪**：跟踪干预效果并调整策略

## 涉及组件

### 核心业务组件
- **FilterBar**：筛选区域组件，管理各种筛选条件
- **TaskSummary**：任务统计卡组件，展示全局统计信息
- **TaskList**：任务列表组件，管理看板式布局
- **TaskCard**：任务卡片组件，展示单条任务详情
- **PomodoroTimer**：番茄计时器组件，提供专注执行功能
- **ReviewForm**：复盘表单组件，收集执行反馈
- **BulkActionBar**：批量操作栏组件，提供批量管理功能
- **StatsDrawer**：数据抽屉组件，展示深度分析

### 交互组件
- **ChipSelector**：芯片选择器组件，支持多选和筛选
- **SearchInput**：搜索输入组件，支持关键词搜索
- **StatusCapsule**：状态胶囊组件，显示任务状态
- **ProgressBar**：进度条组件，显示完成进度
- **ActionButtons**：操作按钮组，提供快捷操作
- **TimeSelector**：时间选择器，支持时间范围选择

### 数据组件
- **MiniChart**：小型图表组件，展示趋势数据
- **SourceBadge**：来源徽章组件，标识任务来源
- **EmotionTag**：情绪标签组件，显示情绪类别
- **PriorityIndicator**：优先级指示器，显示任务优先级
- **RiskAlert**：风险提示组件，显示异常提醒

## 页面跳转关系

### 从任务页跳出的链接
- **任务详情**：点击任务卡"查看详情"进入任务详情页面，提供完整信息和执行历史
- **番茄计时**：点击"开始任务"进入番茄计时器，支持专注执行模式
- **复盘表单**：任务完成后自动弹出复盘表单，记录执行效果
- **统计分析**：点击"查看统计"进入数据抽屉，查看深度分析
- **真人沟通**：真人协同任务点击"联系"打开私聊窗口
- **批量导出**：支持导出行动日志，用于周报生成或专业分享

### 跳转到任务页的入口
- **今天Tab**：从微建议"生成任务"或任务预览卡跳转
- **心情随笔**：从随笔"生成任务"按钮跳转，携带随笔背景
- **树洞Tab**：从行动卡"领取任务"跳转，标记社区来源
- **我的Tab**：从周报"下一步建议"或成长统计跳转
- **跨页面跳转**：各页面点击"查看任务"时携带来源筛选条件

## 数据需求与埋点

### 数据来源
- **任务数据**：`behavior_tasks`表，包含task_id、user_id、source、emotion_category、title、description、estimated_minutes、planned_at、due_at、created_at
- **执行数据**：`task_events`表，包含event_id、task_id、user_id、event_type、event_time、channel、payload、related_checkin_id、notes
- **复盘数据**：`task_reviews`表，包含task_id、mood_before、mood_after、review_notes、attachments、needs_human_followup
- **真人协同**：`task_assignments`表，记录真人指派信息（指派方、审核状态、反馈链接）

### 关键API
- **`/api/tasks`**：获取任务列表、更新状态/提醒设置
- **`/api/tasks/bulk`**：批量延期、批量提醒、批量导出
- **`/api/tasks/summary`**：查询来源/情绪类别统计、延迟原因Top5
- **`/api/tasks/review`**：提交任务复盘、情绪前后评分与附件
- **`/api/pomodoro/start`**：启动番茄计时器
- **`/api/pomodoro/complete`**：完成番茄计时并记录效果

### 埋点事件
- **筛选行为埋点**：记录筛选条件的变化和使用频率
- **任务状态埋点**：记录任务状态的变更和原因
- **执行效果埋点**：记录番茄计时使用效果和任务完成质量
- **批量操作埋点**：记录批量操作的使用情况和效果
- **统计分析埋点**：记录统计数据的查看和交互行为
- **异常干预埋点**：记录异常识别和干预事件的效果
