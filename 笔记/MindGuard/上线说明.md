# 上线说明

适用于 MindGuard 微信小程序从测试包到正式发布的整体流程，涵盖后台配置、审核提交流程与上线注意事项。

## 小程序后台配置

| 配置项 | 说明 | 负责人 |
| --- | --- | --- |
| AppID | `wx-mindguard-001`（示例，实际以运营提供为准） | 运营同学在微信公众平台确认 |
| 开发者成员 | 产品、前端、后端、测试、运营账号均需加入“开发者”或“体验者”列表 | 运营 |
| request 合法域名 | `https://api.mindguard.edu.cn`（正式）<br>`https://stg-api.mindguard.edu.cn`（预发） | 后端提供备案截图，运营配置 |
| uploadFile 合法域名 | `https://upload.mindguard.edu.cn` | 前端确认文件上传路径 |
| downloadFile 合法域名 | 与 request 域名保持一致 | 前端 |
| websocket 合法域名 | 如需实时预警：`wss://ws.mindguard.edu.cn` | 后端 |
| 业务域名 | 官网或活动页 `https://mindguard.edu.cn` | 运营 |
| CDN / 静态资源 | `https://static.mindguard.edu.cn` | 前端 |
| 隐私合规材料 | 《用户协议》《隐私政策》《第三方共享清单》PDF 上传后台 | 合规/运营 |

> 若涉及第三方接口，需在“第三方平台 → 数据安全 → 域名校验”中同步备案。

## 提交审核流程

1. **版本确认**：前端在本地执行 `npm run build:prod` 输出 `dist/`，并通过微信开发者工具上传体验版。
2. **体验版自测**：产品、测试、运营进入体验版完成以下检查：
   - 4 个 Tab 主流程（情绪打卡、日记记录、树洞发帖、SOS）无阻塞。
   - 体验版说明中标注主要功能、测试账号、注意事项。
3. **提审资料准备**：
   - 上传 4 张核心页面截图、1 张 SOS 流程截图。
   - 填写功能介绍，突出“心理辅导工具”“匿名社区”等关键字。
   - 如涉及人工服务，提供客服资质或校方合作函。
4. **提审**：运营在“小程序管理后台 → 版本管理 → 提交审核”中选择对应体验版，填写测试账号与备注。
5. **审核反馈跟进**：
   - 若被驳回，记录修改点并在 24h 内修复。
   - 审核通过后，保留审核通过截图归档。

## 上线注意事项

- **数据安全**：确保正式环境开启 HTTPS，检查请求头是否携带 token，敏感数据落盘前脱敏。
- **风控值班**：树洞与 SOS 流程需安排人工值班（至少 7×16h），并准备紧急联系人列表。
- **性能监控**：在腾讯云或 Serverless 平台配置冷启动监控，阈值：接口响应 < 1.5s，超时自动告警。
- **用户沟通**：提前通过校内群或公众号发预告，明确上线时间与使用须知。
- **回滚策略**：保留上一版已通过审核的代码包，如上线后出现 P0 故障，立即通过“版本回退”恢复。

## 发布步骤

1. **设定发布时间**：审核通过后，在“版本管理 → 线上版本”选择“发布”，可设置定时发布（建议非高峰时段，如 21:30）。
2. **发布前复核**：确认 tabBar 文案、域名、合法文件未变更；体验版最后一次真机检查。
3. **正式发布**：点击“立即发布”，等待微信官方推送成功通知。
4. **发布后验证**：
   - 使用不同系统（iOS/Android）真机验证 4 个主流程。
   - 检查服务器日志与性能指标，确认无异常报警。
   - 运营发布上线公告并收集首日反馈。
5. **灰度与热修复**：若计划灰度，可结合“分阶段发布”逐步扩大用户；紧急问题通过“新版提审 + 快速审核”方式修复。

> 建议上线后前 48 小时安排产品、前端、后端各 1 人值班，确保高优先级反馈能在 30 分钟内响应。
