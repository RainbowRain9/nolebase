# 测试用例

依据功能文档拆解首批功能测试场景，表格统一采用“输入 → 操作步骤 → 预期结果”的结构，后续可在联调阶段补充边界与异常流程。

## 今天 Tab

| 用例编号 | 场景 | 输入 | 操作步骤 | 预期结果 |
| --- | --- | --- | --- | --- |
| TODAY-001 | 多次情绪打卡累计曲线 | 账号存在 1 条历史打卡；今日未打卡 | 1. 进入今天页<br>2. 点击“再次打卡”录入情绪评分/标签/场景<br>3. 再次点击“再次打卡”录入第二条记录 | 心情曲线出现 2 个时间点；状态卡展示最新情绪；`checkins` 写入 2 条记录并携带标签与风险等级 |
| TODAY-002 | 负向情绪触发 ASK 联动 | 风险策略判定为 R2；账号已开通 ASK | 1. 进行情绪打卡选择负向情绪并提交<br>2. 观察浮层并点击“开始对话”<br>3. 输入问题并选择推荐行动 | ASK 浮层自动展开；会话记录入 `ask_sessions`；点击行动写入任务清单并来源标记“ASK-AI” |
| TODAY-003 | 微建议写入任务清单 | 微建议服务返回 3 条建议；清单为空 | 1. 在 Top 微建议区点击“一键加入清单”<br>2. 在弹窗中确认来源与计划时间 | Toast 提示写入成功；任务列表新增记录并显示来源“AI 建议”；页面提示可在任务 Tab 查看 |
| TODAY-004 | 任务复盘回写成长统计 | 任务列表存在 1 条进行中任务 | 1. 点击任务卡“完成”<br>2. 在复盘表单填写情绪前后评分并提交 | 任务状态更新为完成；生成 `task_reviews` 记录；成长统计与周报数据同步更新 |

## 心情随笔 Tab

| 用例编号 | 场景 | 输入 | 操作步骤 | 预期结果 |
| --- | --- | --- | --- | --- |
| JOUR-001 | 多模随笔录入（语音+图片） | 设备语音/相册权限已授权 | 1. 点击“新增随笔”<br>2. 录制语音并自动转写<br>3. 上传手写照片并确认 OCR 结果<br>4. 补充文本与情绪评分后保存 | 随笔列表新增记录并标注“语音+图片”；`journals` 存储转写文本、OCR 内容与情绪标签；若当日未打卡则同步生成情绪打卡 |
| JOUR-002 | AI 摘要筛选关键词 | 账号存在 ≥7 条随笔及情绪打卡 | 1. 查看 AI 摘要卡<br>2. 切换“周 → 月”粒度<br>3. 点击关键词 Chip“室友关系” | 折线图与词云根据粒度更新；列表仅展示包含关键词的随笔；筛选提示展示在列表顶部 |
| JOUR-003 | 随笔派生任务 | 至少存在 1 条随笔 | 1. 打开随笔卡<br>2. 点击“生成任务”<br>3. 选择来源“自建任务”并确认 | 新任务写入清单并回链对应随笔；提示“查看任务 Tab”链接；任务卡显示来源“自建” |
| JOUR-004 | 负向随笔预警与 ASK | 连续 1 条随笔情绪为“焦虑” | 1. 新增随笔设置情绪为“沮丧”并保存 | 系统检测到连续负向情绪，弹出 ASK 提示条与资源按钮；操作记录入 `risk_events` |

## 任务 Tab

| 用例编号 | 场景 | 输入 | 操作步骤 | 预期结果 |
| --- | --- | --- | --- | --- |
| TASK-001 | 来源筛选与统计概览 | 任务库含 AI/社区/真人/自建任务各 1 条 | 1. 打开任务 Tab<br>2. 依次点击“AI”“社区”“真人”“自建”筛选 Chip | 列表仅展示对应来源任务；顶部统计卡随筛选更新；筛选提示可一键清除 |
| TASK-002 | 番茄计时与复盘 | 任意任务状态为进行中 | 1. 点击任务卡“开始”进入计时<br>2. 待计时结束或手动完成<br>3. 填写复盘表单并提交 | 任务状态改为完成；`task_timer_sessions`、`task_reviews` 写入记录；统计抽屉中完成率更新 |
| TASK-003 | 批量延期操作 | 列表存在 2 条即将到期任务 | 1. 进入批量模式多选 2 条任务<br>2. 点击“延期”并设置 +1 天 | 任务卡截止时间更新；生成 `task_status_logs` 记录，原因为“批量延期”；Toast 显示批量操作成功 |
| TASK-004 | 真人指派回执 | 有 1 条来源为辅导员的任务，状态待确认 | 1. 打开任务详情<br>2. 点击“提交回执”填写文字并上传附件<br>3. 提交结果 | 任务状态变为完成并标注“已回执”；`task_acknowledgements` 写入记录；辅导员端收到通知 |

## 树洞 Tab

| 用例编号 | 场景 | 输入 | 操作步骤 | 预期结果 |
| --- | --- | --- | --- | --- |
| HOLE-001 | 发帖自检与风险分级 | 用户实名已通过；内容包含情绪词“累” | 1. 点击“发帖”并填写内容<br>2. 进入草稿自检勾选守则与匿名<br>3. 发布帖子 | 帖子发布成功并展示风险等级（如 L1）；自检结果写入日志；`posts` 记录风险分级与提示语 |
| HOLE-002 | 行动卡领取写入任务清单 | 信息流存在行动卡贴；清单容量未达上限 | 1. 点击行动卡“领取任务”<br>2. 在确认弹窗选择“通知辅导员” | 任务写入清单并源标“树洞”；生成真人待确认任务；提示跳转任务 Tab 查看 |
| HOLE-003 | 高风险帖子资源触达 | 某帖子被标记 L3；资源地图已配置 | 1. 打开带红色提示条帖子<br>2. 点击“查看资源”并选择“联系心理中心” | 跳转资源地图详情并显示联系方式；后台 `risk_alerts` 记录处置动作；若确认联系则生成触达日志 |
| HOLE-004 | 评论触发再次预警 | 帖子为 L2；用户输入包含关键词“想放弃” | 1. 在帖子详情输入评论“最近想放弃努力”<br>2. 点击发送 | 系统拦截并提示风险；允许用户修改或请求 AI/真人帮助；`risk_actions` 记录用户选择 |

## 我的 Tab

| 用例编号 | 场景 | 输入 | 操作步骤 | 预期结果 |
| --- | --- | --- | --- | --- |
| MINE-001 | 查看护心周报并生成任务 | 最新周报已生成；网络正常 | 1. 打开我的 Tab<br>2. 点击护心周报卡“查看完整周报”<br>3. 在建议列表点击“生成任务” | 跳转周报详情；展示情绪趋势、任务完成率（按来源和情绪类别）；生成的任务写入清单并来源标记“周报建议” |
| MINE-002 | 成长统计来源切换 | 清单存在多来源任务及复盘数据 | 1. 滚动至成长统计面板<br>2. 切换“AI 建议/树洞领取/真人指派/自建”分类 | 进度条与数量随分类更新；点击任意分类跳转至任务 Tab 对应筛选结果 |
| MINE-003 | 管理真人授权 | 已向辅导员授权数据访问 | 1. 打开隐私与授权中心<br>2. 点击“辅导员”授权项并选择“撤销授权”<br>3. 确认操作 | 授权状态更新为未授权；`audit_logs` 记录变更；辅导员端收到授权撤销通知 |
| MINE-004 | 资源触达记录 | 资源地图配置“心理中心”热线 | 1. 在资源地图区块点击“心理中心”卡片<br>2. 选择“匿名联系” | 调起电话拨号器并自动填入号码；回到页面后卡片标记“已联系”；`resource_touches` 记录触达结果 |

## 全局

| 用例编号 | 场景 | 输入 | 操作步骤 | 预期结果 |
| --- | --- | --- | --- | --- |
| GLOBAL-001 | 快速记一笔语音转随笔 | 语音权限已开启；网络正常 | 1. 点击悬浮按钮<br>2. 选择语音记录并录制 10 秒<br>3. 确认生成随笔 | 语音成功转文本并写入 `journals`；心情随笔列表刷新；如当日无打卡则同步生成情绪打卡 |
| GLOBAL-002 | Ask 心理助理行动同步 | 账号已登录；网络正常 | 1. 轻点 ASK 浮标打开对话<br>2. 输入“考前焦虑怎么办”<br>3. 点击推荐行动卡“深呼吸练习” | AI 返回建议文本；行动卡写入任务清单并来源标记“ASK-AI”；提示前往任务 Tab 查看 |
| GLOBAL-003 | 晚安模式提醒 | 当前时间 22:30；开启晚安模式 22:00-07:00 | 1. 在任务 Tab 点击任务“开始” | 系统弹出低扰提示并切换夜间主题；仍允许执行任务；记录夜间操作日志 |
| GLOBAL-004 | 登录态失效处理 | 模拟 token 过期；接口返回 401 | 1. 在任何页面下拉刷新 | 弹出登录失效提示；点击后跳转登录页；刷新前页面保留草稿内容 |
