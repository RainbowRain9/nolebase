# 测试用例

依据功能文档拆解首批功能测试场景，表格统一采用“输入 → 操作步骤 → 预期结果”的结构，后续可在联调阶段补充边界与异常流程。

## 今天 Tab

| 用例编号 | 场景 | 输入 | 操作步骤 | 预期结果 |
| --- | --- | --- | --- | --- |
| TODAY-001 | 新用户首次打卡 | 账号为新注册；无历史 `checkins` 记录 | 1. 进入今天页<br>2. 点击情绪头像<br>3. 选择情绪值与标签并提交 | 状态卡显示最新分值与标签；Top3 微建议刷新；数据库新增当日打卡记录 |
| TODAY-002 | 任务执行闭环 | 账号已有 1 条待办任务；通知权限已开启 | 1. 在任务列表点击“开始”<br>2. 待计时结束或手动点击“完成”<br>3. 填写回执并提交 | 任务状态更新为完成；生成 `task_events::done`；回执写入周报源数据；任务条显示完成色块 |
| TODAY-003 | 工具箱跳转校验 | 工具金刚区配置“呼吸练习”链接；网络正常 | 1. 点击“呼吸练习”卡片<br>2. 完成练习后返回 | 正确跳转到练习页面；返回后保持原滚动位置；无重复刷新 |
| TODAY-004 | SOS 长按触发 | 设备支持震动；账号已通过实名校验 | 1. 长按 SOS 按钮 ≥2 秒<br>2. 在弹出的面板选择“拨打守护人” | 弹出 Danger 主题面板并伴随震动；点击后打开电话拨号器；后台记录 SOS 事件日志 |

## 日记 Tab

| 用例编号 | 场景 | 输入 | 操作步骤 | 预期结果 |
| --- | --- | --- | --- | --- |
| JOUR-001 | 创建文本日记 | 用户登录；语音权限可选 | 1. 点击“快速记一笔”<br>2. 选择文本输入并填写内容<br>3. 添加情绪标签并保存 | 新日记出现在列表首位；展示情绪标签与时间；日记计数 +1 |
| JOUR-002 | 查看情绪趋势 | 账号存在 ≥7 天打卡数据 | 1. 打开日记 Tab<br>2. 在情绪趋势头卡切换“周 → 月”<br>3. 点击标签云中的“室友” | 折线图与词云按周期重绘；列表过滤出含“室友”标签的日记；筛选提示显示在列表顶部 |
| JOUR-003 | 任务跳过原因记录 | 清单中至少有 1 条待办 | 1. 切换到“清单”分段<br>2. 在任务卡点击“跳过”<br>3. 选择原因并确认 | 任务状态标记为“已跳过”；生成 `task_events::skipped`，记录原因；今天页同步显示跳过状态 |
| JOUR-004 | 日记转行动任务 | 日记卡存在“生成行动”入口 | 1. 打开任一日记卡<br>2. 点击“生成行动任务”按钮<br>3. 确认任务信息 | 新任务写入清单并标记来源为“日记派生”；今天页任务列表出现高亮提示 |

## 树洞 Tab

| 用例编号 | 场景 | 输入 | 操作步骤 | 预期结果 |
| --- | --- | --- | --- | --- |
| HOLE-001 | 发帖通过自检 | 用户已完成实名；关键词不过敏感阈值 | 1. 点击“发帖”按钮<br>2. 填写内容并下一步<br>3. 勾选礼貌守则与匿名开关<br>4. 点击发布 | 帖子发布成功出现在列表顶部；自检结果写入日志；触发风险检测工作流 |
| HOLE-002 | 领取行动卡 | 信息流存在一条行动卡贴；今日任务未满额 | 1. 点击行动卡上的“领取任务”<br>2. 关注弹出提示 | 显示领取成功 Toast；任务同步到清单并记录来源；卡片变为“已领取”状态 |
| HOLE-003 | 风险提示跳转资源 | 某条帖子被标记 R3 风险；资源配置有效 | 1. 在带风险提示条的帖子点击“查看资源”<br>2. 选择“联系心理中心” | 跳转资源地图详情页；展示联系方式与距离；后台记录风险处置动作 |
| HOLE-004 | 抱抱互动状态 | 帖子互动计数为 0 | 1. 点击帖子底部“抱抱”图标<br>2. 再次点击取消 | 第一次点击计数 +1 并按钮填充主色；第二次点击计数恢复；状态同步后端 |

## 我的 Tab

| 用例编号 | 场景 | 输入 | 操作步骤 | 预期结果 |
| --- | --- | --- | --- | --- |
| MINE-001 | 查看完整周报 | 账号存在最新周报数据；网络正常 | 1. 打开我的 Tab<br>2. 点击护心周报卡“查看完整周报” | 跳转周报详情页；展示折线/条形图；支持返回保持滚动位置 |
| MINE-002 | 徽章解锁引导 | 有未解锁徽章且满足部分条件 | 1. 横向滑动到未解锁徽章<br>2. 点击徽章并查看详情<br>3. 点击“去完成” | 弹出解锁条件模态；点击后跳转到对应页面（如今天 Tab 任务）；记录引导行为 |
| MINE-003 | 撤销授权 | 隐私中心已授权辅导员查看数据 | 1. 进入隐私中心列表<br>2. 点击“辅导员”授权项<br>3. 选择“撤销授权”并确认 | 授权状态变为未授权；生成审计记录；页面出现成功提示 |
| MINE-004 | 资源地图拨号 | 资源地图配置热线号码 | 1. 在资源地图区块点击“心理中心”卡片<br>2. 选择“匿名联系” | 打开电话拨号器并填入热线号码；返回后卡片标记“已联系” |

## 全局

| 用例编号 | 场景 | 输入 | 操作步骤 | 预期结果 |
| --- | --- | --- | --- | --- |
| GLOBAL-001 | 快速记一笔语音记录 | 语音权限已授权；网络正常 | 1. 点击悬浮按钮<br>2. 选择语音记录<br>3. 录制 10 秒并提交 | 语音成功转文本并生成日记；悬浮按钮恢复默认；日记列表更新 |
| GLOBAL-002 | Ask 心理助理问答 | 账号已登录；网络正常 | 1. 轻点 Ask 浮标打开面板<br>2. 输入“考前焦虑怎么办”并发送<br>3. 点击推荐行动卡 | 收到文本建议与行动卡；点击行动卡后任务写入清单并提示成功 |
| GLOBAL-003 | 夜间模式提示 | 系统时间 22:00 后；开启晚安模式配置 | 1. 打开任意页面<br>2. 点击任务开始按钮 | 页面自动切换暗色主题；提示夜间模式 Toast；操作流程不受阻塞 |
| GLOBAL-004 | 登录态失效处理 | 模拟 token 过期；接口返回 401 | 1. 在任何页面下拉刷新<br>2. 观察弹窗 | 弹出登录失效提示；点击后跳转登录页；刷新前页面保留输入草稿 |
