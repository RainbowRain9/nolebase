# 日记综合样式规范（记录 × 复盘 × 行动）

> 参考《功能扩展方案》《社区导向整体开发方案》《tab页设计蓝图》《色彩系统》整理的视觉与实现规范。

## 1. 设计定位
- **角色**：个人情绪与行为的“档案室”，承接自我表达、趋势复盘与任务闭环。
- **核心体验**：上半区聚焦“记录 + 趋势”，下半区聚焦“可执行清单”；二级切换保持互相喂数。
- **视觉基调**：延续 Calm Blue / Mint / Lavender，背景 `--color-ink-0`，卡片白底＋柔和阴影，突出低扰动。

## 2. 布局结构
```
┌──────────────────────────────────────────┐
│ 顶部导航：快速记一笔 / 晚安模式提示 / Segmented 控件（日记｜清单）
├──────────────────────────────────────────┤
│ [日记视图] 情绪趋势 Summary + 标签过滤 + 当日/历史卡片
│            结构化 REBT 模板入口、语音/图片附件标识
│ [清单视图] 微习惯任务列表 + 状态过滤 + 快速领取模板
└──────────────────────────────────────────┘
底部浮层：短按＋快速记一笔，长按 2s SOS
```

## 3. 模块详解
### 3.1 顶部区域
- 顶栏背景白色，阴影 `0 8px 24px rgba(15,20,26,0.04)`，保持滚动吸顶。
- 左侧标题“日记”，右侧按钮组：
  - `快速记一笔`（品牌蓝轮廓按钮）
  - 夜间进入晚安模式提醒（信息色描边 Chip）
- 分段控件：56px 高，圆角 999；选中态填充 `--color-brand-500`，未选中透明配描边。

### 3.2 日记视图 `<JournalView>`
1. **情绪趋势头卡**
   - 上部：周/月切换（选中态品牌色下划线）。
   - 中部：折线图（主线品牌蓝，阈值线 Info-200），数据点使用情绪色盘。
   - 下部：标签云（Chip 背景 `--color-info-50`，文本 Info-600）。
2. **结构化记录入口**
   - 卡片 `#FFFFFF`＋阴影 `0 10px 30px rgba(15,20,26,0.06)`，内含“展开 REBT 模板”CTA（描边按钮）。
3. **日记卡 `<JournalCard>`**
   - 头像＋时间＋情绪标签；正文支持最多三行省略。
  - 附件标签：语音（Lavender）、图片（Mint）、任务关联（Brand）。
   - 底部操作：生成任务（按钮）、收藏、更多。
   - 数据来源：`journals`；生成任务触发 `behavior_tasks`。

### 3.3 清单视图 `<ChecklistView>`
1. **状态过滤**：全部｜进行中｜已完成｜延期，选中态品牌蓝 Chip。
2. **微习惯任务卡 `<TaskCard>`**
   - 卡面背景依据状态：进行中用白底，完成用 `--color-success-50`，延期用 `--color-warning-50`。
   - 信息块：预计时长、提醒时间、步驟 bullet。
   - CTA：开始/完成/跳过按钮；完成后弹出情绪回执（模态）。
3. **模板库横滑区**：呈现“番茄 10min”“整理错题”等，点击生成任务并写入列表。

## 4. 样式变量 & SCSS 片段
```scss
$bg-page: var(--color-ink-0);
$surface: #FFFFFF;
$shadow-card: 0 12px 32px rgba(15,20,26,0.06);
$brand: var(--color-brand-500);
$brand-hover: var(--color-brand-600);
$chip-bg: var(--color-info-50);

.segmented {
  background: rgba(58,123,213,0.08);
  border-radius: 999px;
  padding: 4px;
  .item { color: var(--color-ink-500); }
  .item.is-active {
    background: $brand;
    color: #FFF;
    box-shadow: 0 6px 16px rgba(58,123,213,0.28);
  }
}
.journal-card {
  background: $surface;
  border-radius: 20px;
  box-shadow: $shadow-card;
  padding: 20px;
  .emotion-tag { background: var(--color-info-50); color: var(--color-info-600); }
  .cta {
    color: $brand;
    &:hover { text-decoration: underline; }
  }
}
.task-card {
  border-radius: 20px;
  padding: 20px;
  &.is-active { background: #FFF; border: 1px solid rgba(58,123,213,0.16); }
  &.is-done { background: var(--color-success-50); }
  &.is-late { background: var(--color-warning-50); }
}
```

## 5. 交互与状态
- 顶部 segmented 控件切换时，两个视图互斥；保留最近一次选择。
- 生成任务成功后，显示 Mint Toast“已加入清单”，并滚动到清单视图。
- 任务完成触发 `checkins` 记录情绪数值，同时写入 `task_events::completed`。
- 夜间（22:00-06:00）顶部提示“已切换晚安模式”，控制全局配色暗化。

## 6. 响应式 & 主题
| 断点 | 调整 |
| ---- | ------ |
| `<360px` | 折线图高度减至 120px，任务卡 CTA 转为文本链接 |
| `360-767px` | 默认单列布局 |
| `≥768px` | 趋势卡与日记列表并列两栏，清单改为双栏 Masonry |

- 晚安模式：`$surface -> #1F2730`，正文改 `#D1D7E0`；图表线提升亮度。
- 考试周皮肤：任务模板背景改 `linear-gradient(180deg,#E8FFF4,#D4F6E7)`，强调备考主题。

## 7. 数据与工作流绑定
| 入口 | 工作流/存储 | 说明 |
| ---- | ----------- | ---- |
| 新建日记 | `journals` 表 + 语音/图片上传 | 支持结构化 A-B-C-D-E 字段 |
| 生成任务 | 行为闭环工作流 (`behavior_tasks`,`task_events`) | 同时记录来源 `journal_id` |
| 完成任务 | `task_events::completed` + `checkins` | 回写情绪变化，用于周报 |
| 情绪趋势 | `daily_reports` 聚合 | 周/月维度渲染折线图 |

## 8. 无障碍与验收
- 所有文本对比度 ≥ 4.5:1；图表提供数据点 Tooltip。
- 针对语音附件提供播放控制键盘可用性；
- 折线图在 `prefers-reduced-motion` 下取消动画。
- 验收清单：
  1. 日记/清单切换无卡顿，状态记忆正确；
  2. 任务完成能触发回执弹窗并写入数据；
  3. 模板生成任务后在清单中正确排序；
  4. 夜间模式色板与语义色一致。

---

该规范可直接指导日记页视觉、前端实现及与行为闭环工作流的联调。
