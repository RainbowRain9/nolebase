# MindGuard 《工作分解结构 WBS》（里程碑版）

说明：本 WBS 基于以下资料编制与对齐：docs/功能文档/*.md、docs/页面文档/*.md、docs/数据库/*.md、docs/接口占位文档.md、docs/项目计划/总计划-里程碑与时间线.md。按里程碑阶段输出“功能开发、页面实现、接口开发、数据库设计、测试验证、上线交付”六类任务，采用分级编号的树形结构。

1.0 Alpha 内测（闭环最小可用）
1.1 功能开发
1.1.1 情绪打卡闭环初版 — 实现“打卡→Top3 微建议→一键生成任务”最小链路，含埋点（pv_today/mood_checkin_submit/suggestion_task_create）。
1.1.2 任务卡执行闭环（轻量） — 开始/完成/跳过/复盘表单；番茄计时占位与状态流转联动今天页卡片。（功能-任务卡执行闭环.md）
1.1.3 心情随笔基础版 — 文本录入、多标签、随笔列表；趋势头卡骨架与分段切换。（功能-心情随笔与多模录入.md）
1.1.4 护心周报基础卡 — 我的页展示本周情绪分与建议完成率概览。（功能-护心周报.md）
1.2 页面实现
1.2.1 pages/today/index — 今日状态卡、Top3 微建议、任务预览区与工具区。（页面-今天.md）
1.2.2 pages/tasks/index — 任务列表与状态按钮（开始/完成/跳过/复盘）。（页面-任务.md）
1.2.3 pages/journal/index — 随笔/趋势双视图切换与随笔创建。（页面-心情随笔.md）
1.2.4 pages/mine/index — 周报卡与资料入口骨架。（页面-我的.md）
1.3 接口开发
1.3.1 GET `/api/moods/today` — 返回当日打卡与心情轮；含未打卡占位。（接口占位文档）
1.3.2 POST `/api/checkins` — 写入打卡并回写建议 ID；含幂等校验。（云函数 checkinRecorder）
1.3.3 GET `/api/micro-tips` + PATCH `/api/micro-tips/{id}` — 拉取/接受/跳过建议，联动任务创建。（suggestionOrchestrator）
1.3.4 `/api/tasks`（GET/POST/PATCH/review）— 列表、创建、状态更新与复盘提交。（taskWorkflow）
1.3.5 `/api/journals`（GET/POST）— 随笔列表与创建，支持文本与标签。
1.4 数据库设计
1.4.1 `users` 基础字段 — 资料/角色/风险像素；索引 role/status/last_activity。（集合-用户.users.md）
1.4.2 `checkins` 集合 — 字段与复合索引 user_id+checkin_date；权限最小化。（集合-情绪打卡.checkins.md）
1.4.3 `tasks` 集合 — 字段与索引 user_id+status+due_at；复盘子结构。（集合-任务.tasks.md）
1.4.4 `journals` 集合 — 基础字段、软删标记与索引；附件占位。（集合-心情随笔.journals.md）
1.4.5 `suggestions` 集合 — 建议来源与排序字段；active 状态筛选与索引。（集合-微建议.suggestions.md）
1.5 测试验证
1.5.1 今天页闭环 E2E — TODAY-001~004；真机链路无 4xx/5xx，数据正确落库。（测试用例.md）
1.5.2 任务执行用例 — TASK-001…；状态流转、复盘、统计正确。（测试用例.md）
1.5.3 随笔用例 — JOUR-001…；创建/列表/标签筛选与切换体验。（测试用例.md）
1.5.4 埋点校验 — 关键事件上报齐全并可在 `analyticsIngest` 汇聚。（埋点与数据分析.md）
1.6 上线交付
1.6.1 主包可运行演示 — 构建 npm、体验版上传与内测名单配置。（上线说明.md）
1.6.2 合法域名与环境 — `USE_MOCK` 切换说明、预发/正式域名登记、`project.private.config.json` 审核。（上线说明.md）
1.6.3 监控基线 — 崩溃率/接口错误率/埋点漏斗接入告警。（运维与监控.md）

2.0 Beta 公测（社区与安全场景）
2.1 功能开发
2.1.1 树洞发帖/抱抱/风险提示（L1-L2）— 发帖、详情、互动与温和守护提示；高风险走审核与提醒。（功能-树洞*.md）
2.1.2 行动卡领取与同步 — 社区行动卡转任务，today/tasks 双向同步。（功能-行动卡领取与同步.md）
2.1.3 晚安模式与低扰提醒 — 夜间推送策略与免打扰；提示位在今天/随笔/我的。（功能-晚安模式与低扰提醒.md）
2.1.4 SOS 独立分包 — 稳定化脚本、资源切换与紧急触发；与值班流程联动。（功能-SOS安全守护.md）
2.1.5 护心周报详情与导出 — 周报详情页、导出图片/PDF 与分享。（页面-日记域-周报导出.md）
2.1.6 隐私与授权中心 — 守护人管理、授权查看/撤销与审计。（功能-隐私授权中心.md）
2.1.7 徽章与通知 — 徽章解锁/进度；系统通知/未读数。（集合-徽章.badges.md、集合-通知.notifications.md）
2.1.8 资源地图 — 校内外心理资源聚合与导航。（页面-个人-资源地图.md）
2.2 页面实现
2.2.1 packages/community/* — 帖子详情、发布、话题、消息、资源广场、活动/预约、心理咨询、客服与帮助、搜索、学术资源等页面。（页面-社区-*.md）
2.2.2 independent/sos/* — SOS 主页与资源切换。（页面-SOS-*.md）
2.2.3 packages/profile/* — 周报详情、徽章详情、隐私中心、资源地图、资料编辑、学校协同、审核中心、反馈。（页面-个人-*.md）
2.2.4 packages/tasks/task-detail — 任务详情页与番茄/复盘组件。（页面-任务域-任务详情.md）
2.3 接口开发
2.3.1 `/api/treehole/*` — 帖子列表/发布/详情/互动/话题/搜索；高亮流。（接口占位文档）
2.3.2 `/api/reports/weekly` GET/PATCH、`/api/reports/export` POST — 周报读取/导出。
2.3.3 `/api/privacy/consents` GET/PATCH — 授权/守护人管理。
2.3.4 `/api/badges` GET、`/api/notifications*` GET — 徽章与通知中心。
2.3.5 云函数：`treeholeModeration`/`sosRelay`/`weeklyReport`/`analyticsIngest` — 审核、紧急联动、报表与埋点汇聚。
2.4 数据库设计
2.4.1 `posts`/`comments` 集合 — 字段、风险评分/审核状态、主索引；权限与匿名策略。（集合-树洞帖子.posts.md、集合-树洞互动.comments.md）
2.4.2 `reports` 集合 — 周报/风险报告结构与索引；导出记录。（集合-周报与风控.reports.md）
2.4.3 `notifications` 集合 — 消息类型、未读统计与索引。（集合-通知.notifications.md）
2.4.4 `sos_events` 集合 — 触发事件、严重度与处置流程字段。（集合-SOS事件.sos.md）
2.5 测试验证
2.5.1 社区主流程 — 发帖/互动/风险提示/HUG 行为；高风险触发审核与拦截。（测试用例.md）
2.5.2 SOS 演练 — 触发→稳定化→联系人→转介闭环；记录 ticket。（接口-复杂模块子文档）
2.5.3 性能与包体预算 — 主包/分包≤2MB、首屏 TTI≤1.5s；预加载命中校验。（页面文档/README.md）
2.5.4 埋点漏斗 — 发帖转化、任务转化、周报查看；看板验证。（埋点与数据分析.md）
2.6 上线交付
2.6.1 公测计划与灰度 — 邀测→白名单→开放；回滚预案与热修策略。（上线说明.md）
2.6.2 审核资料初稿 — 截图/功能说明/测试账号；合规材料与域名白名单。（上线说明.md）
2.6.3 值班与风控 — 树洞/ SOS 值班排班与演练记录；异常处置手册。（运维与监控.md）

3.0 正式版发布（全量与稳定性）
3.1 功能开发
3.1.1 核心流程收口 — 今天/任务/随笔/树洞/SOS/周报/隐私中心全量可用与一致性处理。
3.1.2 失败重试与异常处理 — 接口容错、兜底文案与失败埋点；离线与弱网策略。
3.1.3 灰度放量与回滚预案 — 可配置放量、快速回滚与版本对比看板。
3.2 页面实现
3.2.1 全量页面上线标准 — UI 走查、路由/预加载一致性、自测通过与可访问性检查。
3.3 接口开发
3.3.1 接口契约冻结 — 对齐 docs/接口占位文档.md 字段与错误码；统一 telemetry 与错误语义。
3.3.2 监控与告警完善 — 接口超时/错误率 SLO 配置到位，trace_id 贯通。
3.4 数据库设计
3.4.1 索引巡检与迁移 — 历史索引清理、必要迁移脚本与回滚脚本归档。（数据库设计.md）
3.4.2 审计/告警留痕 — 操作/访问/变更日志留痕策略验证可追溯。（集合-用户事件.events.md）
3.5 测试验证
3.5.1 E2E 主流程 — 关键路径 100% 通过；CI 绿色（lint/单测/E2E）。
3.5.2 兼容与真机矩阵 — iOS/Android/不同网络环境；弱网/权限/失败场景。
3.5.3 性能基线复核 — TTI/内存/掉帧；冷启动与分包命中率达标。
3.6 上线交付
3.6.1 提审资料齐套 — 截图/文案/账号/隐私协议；域名/资质核验。（上线说明.md）
3.6.2 发布与回滚演练 — 线上发布演练、48h 值班与首周监控复盘。（运维与监控.md）

4.0 功能扩展（能力深化与生态）
4.1 功能开发
4.1.1 学校协同系统 — 学校绑定/协同工作台/人工转介；与风险/通知联动。（功能-学校协同系统.md）
4.1.2 专题工具箱 — 呼吸与正念工具分包；完成写回任务闭环。（页面-呼吸-主页.md、页面-正念-主页.md）
4.1.3 ASK 心理助理增强 — REBT/CBT 深化与随笔一键提取；与建议编排闭环。（功能-Ask心理助理.md）
4.1.4 个性化资源推送 — 资源画像与推送编排；来源与转化埋点。（功能-资源推送系统.md）
4.1.5 社区话题与活动 — 话题聚合、活动广场与报名联动任务。（页面-社区-话题聚合.md、页面-社区-活动广场.md）
4.2 页面实现
4.2.1 packages/profile/school-cooperation — 协同面板与预警/审核链路。（页面-个人-学校协同.md）
4.2.2 packages/breath/*、packages/mindfulness/* — 工具分包 UI 与回执行为。（页面-呼吸-主页.md、页面-正念-主页.md）
4.2.3 页面增强 — 今天资源推送区、社区扩展页与入口打通。（页面-资源推送.md）
4.3 接口开发
4.3.1 `/api/resources` — 资源聚合/分类/个性化；社区与个人页复用。
4.3.2 学校协同相关接口 — 预警列表/详情/指派/统计；审核决策与审计日志。
4.3.3 建议编排增强 — `suggestionOrchestrator` 策略升级与召回多源。
4.4 数据库设计
4.4.1 `resources` 集合 — 资源分类/联系方式/运营位；必要索引与权限。（集合-资源地图.resources.md）
4.4.2 评测/资源关联 — 画像与资源/任务/活动关联模型；增量迁移脚本。
4.5 测试验证
4.5.1 工具闭环 — 呼吸/正念→任务→复盘转化率；弱网与离线回执。
4.5.2 协同链路 — 预警→审核→指派→回执；权限与审计验证。
4.5.3 推送与推荐 — 资源曝光/点击/转化漏斗与 A/B 配置验证。
4.6 上线交付
4.6.1 数据看板拓展 — 埋点字段与指标体系扩展；运营周报模板。（埋点与数据分析.md）
4.6.2 生态合作 — 校内资源入驻流程与运营台账；合规复核。

—

参考索引与映射
- 页面索引：docs/页面文档/README.md（路由与分包）
- 接口清单：docs/接口占位文档.md（REST/云函数与映射表）
- 数据库设计：docs/数据库设计.md 与 docs/数据库/*.md（集合/索引/权限）
- 功能清单：docs/功能列表.md（范围与优先级）

—

变更记录
- 2025-09-22：按 Alpha/Beta/正式/扩展 重构为树形 WBS；补齐每节点交付物描述与页面/接口/集合对齐；新增参考索引区并对接总计划时间线。

