# MindGuard 《工作分解结构 WBS》

## 模块：公共组件
| 类型 | 任务名 | 前置依赖 | 产出物 | 验收标准 | 涉及文档链接 |
| --- | --- | --- | --- | --- | --- |
| 前端 | tabBar 主包骨架搭建 | 无 | 更新后的 app.json 主包配置与 pages/today、pages/journal、pages/tasks、pages/treehole、pages/mine 空页面骨架 | 微信开发者工具可正常加载五个 Tab；路由与样式符合《分包规划方案》 | [分包规划方案](docs/分包规划方案.md)<br>[页面-今天](docs/页面文档/页面-今天.md) |
| 前端 |心情随笔视图与趋势切换实现 | 公共卡片与按钮组件库初版 | JournalTabs 组件与趋势视图骨架 | 分段切换在真机无闪烁；随笔/趋势视图与文档一致| tabBar 主包骨架搭建 | components 目录下的卡片、按钮、宫格基础组件 | 组件在今天与心情随笔页复用不破版；通过设计走查并匹配《页面文档》示例 | [页面-今天](docs/页面文档/页面-今天.md)<br>[页面-心情随笔](docs/页面文档/页面-心情随笔.md) |
| 测试 | 公共组件可用性冒烟测试 |心情随笔视图与趋势切换实现 | 公共卡片与按钮组件库初版 | JournalTabs 组件与趋势视图骨架 | 分段切换在真机无闪烁；随笔/趋势视图与文档一致| Jest 与真机冒烟用例清单及测试报告 | 核心组件交互用例全部通过；发现缺陷均登记到缺陷库 | [测试用例](docs/测试用例.md) |

## 模块：今天（Home）
| 类型 | 任务名 | 前置依赖 | 产出物 | 验收标准 | 涉及文档链接 |
| --- | --- | --- | --- | --- | --- |
| 前端 | TopMoodCard 情绪打卡面板实现 |心情随笔视图与趋势切换实现 | 公共卡片与按钮组件库初版 | JournalTabs 组件与趋势视图骨架 | 分段切换在真机无闪烁；随笔/趋势视图与文档一致| TopMoodCard 组件与心情轮交互逻辑 | 真机完成情绪打卡流程；UI 与交互符合文档描述 | [页面-今天](docs/页面文档/页面-今天.md)<br>[功能-情绪打卡](docs/功能文档/功能-情绪打卡.md) |
| 前端 | Top3 微建议列表与一键任务交互 | TopMoodCard 情绪打卡面板实现 | 微建议列表组件、刷新按钮、一键生成状态 | 微建议可刷新、生成任务后状态反馈正确；埋点占位待联调 | [功能-微建议与任务生成](docs/功能文档/功能-微建议与任务生成.md) |
| 前端 | 今日任务列表与状态同步 | Top3 微建议列表与一键任务交互 | 今日任务列表区、状态切换逻辑、回执入口 | 开始、完成、跳过操作状态正确；回执入口跳转成功 | [功能-任务卡执行闭环](docs/功能文档/功能-任务卡执行闭环.md)<br>[页面-今天](docs/页面文档/页面-今天.md) |
| 数据库 | checkins 集合索引与权限配置 | 无 | checkins 索引及权限变更脚本与评审记录 | 索引在云开发控制台创建成功；权限校验通过测试账号验证 | [集合-情绪打卡.checkins](docs/数据库/集合-情绪打卡.checkins.md) |
| 联调 | 情绪打卡与微建议接口联调 | 今日任务列表与状态同步、checkins 集合索引与权限配置、taskReceipt 云函数实现与写入校验 | /api/moods/today、/api/micro-tips、/api/tasks 联调记录 | 真机端到端链路无 4xx/5xx；任务写入 tasks 集合成功 | [接口占位文档](docs/接口占位文档.md)<br>[集合-任务.tasks](docs/数据库/集合-任务.tasks.md) |
| 测试 | 今天页主流程测试执行 | 情绪打卡与微建议接口联调 | 测试用例、缺陷单、通过结论 | 情绪打卡、微建议、任务生成三大流程测试通过且缺陷关闭率≥95% | [测试用例](docs/测试用例.md) |
| 运维 | 今天页监控与埋点告警配置 | 今天页主流程测试执行、今天与心情随笔关键事件埋点集成 | Grafana/飞书告警配置、监控手册更新 | 关键指标（崩溃率、接口错误率、埋点漏斗）接入监控并触发测试告警 | [运维与监控](docs/运维与监控.md)<br>[埋点与数据分析](docs/埋点与数据分析.md) |

## 模块：心情随笔
| 类型 | 任务名 | 前置依赖 | 产出物 | 验收标准 | 涉及文档链接 |
| --- | --- | --- | --- | --- | --- |
| 前端 | 心情随笔视图与趋势切换实现 | 公共卡片与按钮组件库初版 | JournalTabs 组件、趋势视图骨架 | 分段切换真机无闪烁；随笔/趋势视图功能符合文档 | [页面-心情随笔](docs/页面文档/页面-心情随笔.md) |
| 前端 | 心情随笔多模录入 | 心情随笔视图与趋势切换实现 | 多模录入表单组件、附件上传入口 | 文本/语音/图片/REBT 表单可保存；附件上传回显正常 | [功能-心情随笔与多模录入](docs/功能文档/功能-心情随笔与多模录入.md) |
| 数据库 | journals 集合索引与软删策略落地 | 无 | journals 索引与权限脚本、软删执行方案 | 索引建立成功；软删字段通过测试账号验证；权限表达式正确 | [集合-心情随笔.journals](docs/数据库/集合-心情随笔.journals.md) |
| 联调 | /api/journals 接口联调 | 心情随笔多模录入、journals 集合索引与软删策略落地、taskReceipt 云函数实现与写入校验 | /api/journals 联调记录与 Swagger 更新 | 心情随笔创建、查询、生成任务链路无错误；任务写入任务看板成功 | [接口占位文档](docs/接口占位文档.md)<br>[集合-任务.tasks](docs/数据库/集合-任务.tasks.md) |
| 测试 | 心情随笔模块专项测试 | /api/journals 接口联调 | 测试报告、缺陷闭环记录 | 心情随笔记录、过滤、模板、生成任务用例全部通过 | [测试用例](docs/测试用例.md) |
| 运维 | 心情随笔数据备份与脱敏流程配置 | 心情随笔模块专项测试 | 备份脚本、脱敏清单、执行排程 | journals 每日快照入 COS；脱敏脚本抽检通过 | [运维与监控](docs/运维与监控.md)<br>[集合-心情随笔.journals](docs/数据库/集合-心情随笔.journals.md) |
## 模块：任务
| 类型 | 任务名 | 前置依赖 | 产出物 | 验收标准 | 涉及文档链接 |
| --- | --- | --- | --- | --- | --- |
| 前端 | 任务 Tab 看板实现 | 公共卡片与按钮组件库初版 | TasksBoard 组件、来源筛选、任务卡 UI | 来源/状态筛选可用，任务状态联动番茄计时与复盘；埋点对齐 | [页面-任务](docs/页面文档/页面-任务.md)<br>[功能-清单任务管理](docs/功能文档/功能-清单任务管理.md) |
| 前端 | 任务统计与数据抽屉 | 任务 Tab 看板实现 | StatsDrawer 组件、来源/情绪图表 | 数据抽屉展开正常；来源点击可回到筛选结果；图表加载性能满足要求 | [页面-任务](docs/页面文档/页面-任务.md)<br>[埋点与数据分析](docs/埋点与数据分析.md) |
| 前端 | 批量操作与提醒策略 | 任务 Tab 看板实现 | BulkActionBar 组件、批量延期/提醒/导出流程 | 批量操作可执行并写入日志；提醒策略覆盖到期前 15m/到期/+30m | [页面-任务](docs/页面文档/页面-任务.md)<br>[功能-任务卡执行闭环](docs/功能文档/功能-任务卡执行闭环.md) |
| 数据库 | tasks 集合索引与统计脚本 | journals 集合索引与软删策略落地 | tasks 索引、统计聚合脚本 | 来源+状态组合索引创建完成；统计脚本支持来源/情绪聚合 | [集合-心情随笔.journals](docs/数据库/集合-心情随笔.journals.md)<br>[集合-任务.tasks](docs/数据库/集合-任务.tasks.md) |
| 埋点 | 任务看板埋点联调 | 任务 Tab 看板实现、埋点封装 | 埋点对照表、ClickHouse 核对截图 | `pv_tasks`、`tasks_filter_change`、`task_bulk_action` 上报准确，参数与业务对账偏差 <5% | [埋点与数据分析](docs/埋点与数据分析.md) |
## 模块：树洞
| 类型 | 任务名 | 前置依赖 | 产出物 | 验收标准 | 涉及文档链接 |
| --- | --- | --- | --- | --- | --- |
| 前端 | 树洞信息流与风险角标 UI 实现 | 公共卡片与按钮组件库初版 | 信息流组件、风险角标渲染、温和提示弹层 | 风险等级 R1-R4 UI 区分明显；温和提示交互符合需求 | [页面-树洞](docs/页面文档/页面-树洞.md)<br>[功能-树洞风险提示与温和守护](docs/功能文档/功能-树洞风险提示与温和守护.md) |
| 前端 | 发帖向导与草稿自检流程 | 树洞信息流与风险角标 UI 实现 | 发帖多步表单、草稿自检提示 | 草稿自检阻断与提示文案符合需求；成功发布回到信息流 | [功能-树洞发帖与草稿自检](docs/功能文档/功能-树洞发帖与草稿自检.md) |
| 数据库 | posts 集合索引与风险字段配置 | 无 | posts 集合索引与权限脚本、风险字段确认记录 | 索引创建成功；风险字段能被模型与人工更新 | [集合-树洞帖子.posts](docs/数据库/集合-树洞帖子.posts.md) |
| 联调 | 树洞发帖与风险提示接口联调 | 发帖向导与草稿自检流程、posts 集合索引与风险字段配置、syncActionCardTask 云函数实现 | /api/treehole/posts、/api/treehole/risk-hints 联调记录 | 发布、草稿、风险提示链路通过；行动卡任务写入成功 | [接口占位文档](docs/接口占位文档.md)<br>[功能-行动卡领取与同步](docs/功能文档/功能-行动卡领取与同步.md) |
| 测试 | 树洞风控演练测试 | 树洞发帖与风险提示接口联调 | 风控演练脚本、缺陷列表、演练报告 | R3/R4 告警触发并通知到位；演练问题闭环 | [运维与监控](docs/运维与监控.md)<br>[功能-树洞风险提示与温和守护](docs/功能文档/功能-树洞风险提示与温和守护.md) |
| 运维 | 树洞值班 SOP 与告警路由优化 | 树洞风控演练测试 | 更新后的值班手册、飞书告警配置 | 告警升级链路符合 SLA；值班表已发布 | [运维与监控](docs/运维与监控.md) |
## 模块：我的
| 类型 | 任务名 | 前置依赖 | 产出物 | 验收标准 | 涉及文档链接 |
| --- | --- | --- | --- | --- | --- |
| 前端 | 护心周报卡与详情入口实现 | 公共卡片与按钮组件库初版 | 周报卡组件、详情跳转、建议生成入口 | 周报数据展示正确；生成任务按钮触发成功 | [页面-我的](docs/页面文档/页面-我的.md)<br>[功能-护心周报](docs/功能文档/功能-护心周报.md) |
| 前端 | 隐私与授权中心 UI 开发 | 护心周报卡与详情入口实现 | 授权列表、操作弹窗、审计入口 | 授权列表渲染与撤销操作无异常；UI 符合文档 | [功能-隐私授权中心](docs/功能文档/功能-隐私授权中心.md) |
| 前端 | 成长统计与徽章展示 | 护心周报卡与详情入口实现 | 成长统计组件、徽章滑动组件 | 来源完成率、徽章状态展示正确；跳转任务 Tab 正常 | [页面-我的](docs/页面文档/页面-我的.md)<br>[功能-徽章成就体系](docs/功能文档/功能-徽章成就体系.md) |
| 数据库 | users 与 reports 权限及索引核查 | 无 | users 与 reports 集合权限、索引更新记录 | 权限表达式通过测试账号验证；索引创建成功 | [集合-用户.users](docs/数据库/集合-用户.users.md)<br>[集合-周报与风控.reports](docs/数据库/集合-周报与风控.reports.md) |
| 联调 | 周报与授权接口联调 | 隐私与授权中心 UI 开发、users 与 reports 权限及索引核查、generateWeeklyReport 云函数数据聚合 | /api/reports/weekly、/api/privacy/consents 联调记录 | 周报数据加载正确；授权撤销写入成功并落库 | [接口占位文档](docs/接口占位文档.md) |
| 测试 | 我的 Tab 功能测试 | 周报与授权接口联调 | 测试报告、用例集 | 周报、徽章、授权操作相关用例通过；缺陷清零 | [测试用例](docs/测试用例.md) |
| 运维 | 周报推送与隐私审计巡检流程 | 我的 Tab 功能测试 | 推送计划、审计清单、操作手册 | 周报推送试跑成功；隐私审计日志每周产出 | [运维与监控](docs/运维与监控.md)<br>[上线说明](docs/上线说明.md) |
## 模块：独立分包 SOS
| 类型 | 任务名 | 前置依赖 | 产出物 | 验收标准 | 涉及文档链接 |
| --- | --- | --- | --- | --- | --- |
| 前端 | SOS 面板与资源入口 UI 实现 |心情随笔视图与趋势切换实现 | 公共卡片与按钮组件库初版 | JournalTabs 组件与趋势视图骨架 | 分段切换在真机无闪烁；随笔/趋势视图与文档一致| independent/sos 页面、资源跳转入口 | 长按浮标秒开 SOS 面板；资源跳转正常 | [功能-SOS安全守护](docs/功能文档/功能-SOS安全守护.md) |
| 数据库 | sos 集合权限与索引配置 | 无 | sos 集合索引、权限表达式 | 权限规则经测试账号验证；索引创建成功 | [集合-SOS事件.sos](docs/数据库/集合-SOS事件.sos.md) |
| 联调 | SOS 触发与守护通知联调 | SOS 面板与资源入口 UI 实现、sos 集合权限与索引配置、pushGuardianAlert 云函数发布 | /api/sos/trigger 与守护通知回执联调记录 | SOS 触发至通知链路无失败；回执写入成功 | [接口占位文档](docs/接口占位文档.md)<br>[集合-SOS事件.sos](docs/数据库/集合-SOS事件.sos.md) |
| 测试 | SOS 流程演练测试 | SOS 触发与守护通知联调 | 演练脚本、演练报告 | 触发、取消、升级场景全部通过；演练缺陷闭环 | [运维与监控](docs/运维与监控.md) |
| 运维 | SOS 值班与应急响应计划 | SOS 流程演练测试 | 值班排班表、应急联系人清单 | 值班表覆盖 7×16 小时；应急联系人确认签字 | [运维与监控](docs/运维与监控.md)<br>[上线说明](docs/上线说明.md) |

## 模块：云函数
| 类型 | 任务名 | 前置依赖 | 产出物 | 验收标准 | 涉及文档链接 |
| --- | --- | --- | --- | --- | --- |
| 云函数 | taskReceipt 云函数实现与写入校验 | checkins 集合索引与权限配置 | taskReceipt 代码、单元测试、部署记录 | 任务回执写入 checkins 成功；单元测试覆盖核心路径 | [集合-情绪打卡.checkins](docs/数据库/集合-情绪打卡.checkins.md)<br>[功能-任务卡执行闭环](docs/功能文档/功能-任务卡执行闭环.md) |
| 云函数 | syncActionCardTask 云函数实现 | posts 集合索引与风险字段配置 | syncActionCardTask 代码、部署记录 | 行动卡领取后任务落库成功；重复领取具备幂等校验 | [功能-行动卡领取与同步](docs/功能文档/功能-行动卡领取与同步.md) |
| 云函数 | generateWeeklyReport 云函数数据聚合 | users 与 reports 权限及索引核查 | 周报生成函数、调度配置 | 周报生成成功写入 reports；耗时小于 2 分钟 | [功能-护心周报](docs/功能文档/功能-护心周报.md)<br>[集合-周报与风控.reports](docs/数据库/集合-周报与风控.reports.md) |
| 云函数 | pushGuardianAlert 云函数发布 | sos 集合权限与索引配置 | 守护通知函数、短信或 IM 通道配置 | 高危事件触发守护通知成功；失败重试记录完整 | [功能-SOS安全守护](docs/功能文档/功能-SOS安全守护.md)<br>[集合-SOS事件.sos](docs/数据库/集合-SOS事件.sos.md) |
| 云函数 | schemaValidator 与 migrationRunner 工具化上线 | 无 | 工具云函数代码、使用说明 | 本地与云端迁移演练通过；日志写入 migration_logs | [校验与迁移策略](docs/数据库/校验与迁移策略.md) |
| 测试 | 云函数单元与集成测试集 | 所有云函数实现任务 | 自动化测试脚本、CI 报告 | 关键云函数测试全部通过；失败率低于 5% | [测试用例](docs/测试用例.md) |
| 运维 | 云函数日志与灰度发布配置 | 云函数单元与集成测试集 | 日志采集规则、灰度发布计划 | 云函数异常可在 5 分钟内定位；灰度发布流程演练通过 | [运维与监控](docs/运维与监控.md)<br>[上线说明](docs/上线说明.md) |

## 模块：埋点
| 类型 | 任务名 | 前置依赖 | 产出物 | 验收标准 | 涉及文档链接 |
| --- | --- | --- | --- | --- | --- |
| 前端 | 埋点封装与事件枚举实现 |心情随笔视图与趋势切换实现 | 公共卡片与按钮组件库初版 | JournalTabs 组件与趋势视图骨架 | 分段切换在真机无闪烁；随笔/趋势视图与文档一致| analytics.ts 封装、事件常量 | 统一封装供各页面调用；代码通过 lint | [埋点与数据分析](docs/埋点与数据分析.md) |
| 前端 | 今天与心情随笔关键事件埋点集成 | 埋点封装与事件枚举实现、Top3 微建议列表与一键任务交互、心情随笔与多模录入 | 埋点调用实现、事件对照表 | pv_today、mood_checkin_submit、journal_entry_submit 等事件在真机可上报 | [埋点与数据分析](docs/埋点与数据分析.md) |
| 前端 | 树洞与我的埋点补充 | 埋点封装与事件枚举实现、树洞信息流与风险角标 UI 实现、护心周报卡与详情入口实现 | 树洞与我的事件埋点实现 | treehole_post_publish、weekly_report_view 等事件数据完整 | [埋点与数据分析](docs/埋点与数据分析.md) |
| 数据库 | events 集合索引与权限配置 | 无 | events 集合索引与权限脚本 | 索引创建成功；权限规则限制写入角色 | [集合-用户事件.events](docs/数据库/集合-用户事件.events.md) |
| 联调 | 埋点采集链路联调 | 今天与心情随笔关键事件埋点集成、events 集合索引与权限配置 | 数据通路联调报告、ClickHouse 核对截图 | 关键事件数据在 ClickHouse 看板可见，偏差小于 5% | [埋点与数据分析](docs/埋点与数据分析.md) |
| 测试 | 埋点自动校验脚本执行 | 埋点采集链路联调 | 校验脚本结果、异常报告 | 日常校验无新增丢失事件；异常自动通知 | [埋点与数据分析](docs/埋点与数据分析.md) |
| 运维 | 埋点看板与告警配置 | 埋点采集链路联调 | Superset 或 Grafana 看板、告警阈值配置 | 关键漏斗下降超过 20% 自动告警；看板每周更新 | [埋点与数据分析](docs/埋点与数据分析.md)<br>[运维与监控](docs/运维与监控.md) |

## 关键路径
- tabBar 主包骨架搭建 → TopMoodCard 情绪打卡面板实现 → checkins 集合索引与权限配置 → taskReceipt 云函数实现与写入校验 → 情绪打卡与微建议接口联调 → 今天页主流程测试执行 → 今天页监控与埋点告警配置
-心情随笔视图与趋势切换实现 | 公共卡片与按钮组件库初版 | JournalTabs 组件与趋势视图骨架 | 分段切换在真机无闪烁；随笔/趋势视图与文档一致→ 心情随笔视图与趋势切换实现 → journals 集合索引与软删策略落地 → /api/journals 接口联调 → 心情随笔模块专项测试 → 心情随笔数据备份与脱敏流程配置
- 树洞信息流与风险角标 UI 实现 → posts 集合索引与风险字段配置 → syncActionCardTask 云函数实现 → 树洞发帖与风险提示接口联调 → 树洞风控演练测试 → 树洞值班 SOP 与告警路由优化
- 护心周报卡与详情入口实现 → users 与 reports 权限及索引核查 → generateWeeklyReport 云函数数据聚合 → 周报与授权接口联调 → 我的 Tab 功能测试 → 周报推送与隐私审计巡检流程
- SOS 面板与资源入口 UI 实现 → sos 集合权限与索引配置 → pushGuardianAlert 云函数发布 → SOS 触发与守护通知联调 → SOS 流程演练测试 → SOS 值班与应急响应计划













